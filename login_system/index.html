<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة المتجر</title>
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 0;
            margin-bottom: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            padding: 20px;
        }

        .login-language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1001;
        }

        .login-language-switcher select {
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            background: white;
            color: #333;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .language-switcher select {
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            background: white;
            color: #333;
        }

        .login-form {
            background: white;
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .demo-credentials {
            background: #e3f2fd;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #2196f3;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: right;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin: 3px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #2ed573 0%, #1e90ff 100%);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
        }

        .btn-excel {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
        }

        .btn-pdf {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffa726 0%, #ff9800 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #29b6f6 0%, #03a9f4 100%);
        }

        .btn-email {
            background: linear-gradient(135deg, #1e88e5 0%, #1976d2 100%);
        }

        .link-btn {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9rem;
            margin: 0.5rem;
            padding: 5px;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: #666;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .tab-content {
            display: none;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 0.8rem;
        }

        th, td {
            padding: 8px 6px;
            text-align: right;
            border-bottom: 1px solid #e1e5e9;
            min-width: 100px;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            font-size: 0.75rem;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .new-order-input, .order-id-input {
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            width: 100%;
        }

        .order-id-input {
            background: #e8f5e8;
            border-color: #c8e6c9;
            font-weight: bold;
            color: #2e7d32;
            text-align: center;
        }

        .order-id-input:focus {
            background: white;
            border-color: #4caf50;
        }

        .message {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .user-info {
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-badge {
            background: #ffd700;
            color: #333;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .copied-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 9999;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .export-section {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-right: 4px solid #2ed573;
        }

        .export-section h4 {
            color: #2ed573;
            margin-bottom: 1rem;
        }

        .bulk-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            padding: 6px 10px;
            font-size: 0.7rem;
            margin: 2px;
        }

        .quick-search {
            background: #e3f2fd;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-right: 4px solid #2196f3;
        }

        .quick-search h4 {
            color: #2196f3;
            margin-bottom: 1rem;
        }

        .search-results {
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .search-result-item {
            background: white;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .search-result-item:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }

        .search-result-header {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .form-row-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .report-card {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .report-header {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 1rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }

        /* Action Select Styles */
        .action-select {
            padding: 6px 8px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 0.8rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
            min-width: 120px;
        }

        .action-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .action-select option {
            padding: 8px;
        }

        .editable-cell {
            background: transparent;
            border: 1px solid transparent;
            padding: 4px;
            font-size: 0.8rem;
            min-width: 100px;
            width: 100%;
            border-radius: 4px;
        }

        .editable-cell:focus {
            background: white;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .editable-cell:hover {
            background: #f8f9fa;
            border-color: #e1e5e9;
        }

        /* Email Section Styles */
        .email-section {
            background: #e3f2fd;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-right: 4px solid #1e88e5;
        }

        .email-section h4 {
            color: #1e88e5;
            margin-bottom: 1rem;
        }

        .email-config {
            background: #fff3e0;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-right: 4px solid #ff9800;
        }

        .email-config h4 {
            color: #ff9800;
            margin-bottom: 1rem;
        }

        .email-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 8px;
        }

        .email-status.success {
            background: #d4edda;
            color: #155724;
        }

        .email-status.error {
            background: #f8d7da;
            color: #721c24;
        }

        /* RTL Support */
        [dir="rtl"] th,
        [dir="rtl"] td {
            text-align: right;
        }

        [dir="ltr"] th,
        [dir="ltr"] td {
            text-align: left;
        }

        [dir="rtl"] .export-section {
            border-left: none;
            border-right: 4px solid #2ed573;
        }

        [dir="ltr"] .export-section {
            border-right: none;
            border-left: 4px solid #2ed573;
        }

        [dir="rtl"] .quick-search {
            border-left: none;
            border-right: 4px solid #2196f3;
        }

        [dir="ltr"] .quick-search {
            border-right: none;
            border-left: 4px solid #2196f3;
        }

        [dir="rtl"] .email-section {
            border-left: none;
            border-right: 4px solid #1e88e5;
        }

        [dir="ltr"] .email-section {
            border-right: none;
            border-left: 4px solid #1e88e5;
        }

        [dir="rtl"] .email-config {
            border-left: none;
            border-right: 4px solid #ff9800;
        }

        [dir="ltr"] .email-config {
            border-right: none;
            border-left: 4px solid #ff9800;
        }

        [dir="rtl"] .copied-notification {
            right: 20px;
            left: auto;
        }

        [dir="ltr"] .copied-notification {
            left: 20px;
            right: auto;
        }

        [dir="rtl"] .login-language-switcher {
            right: 20px;
            left: auto;
        }

        [dir="ltr"] .login-language-switcher {
            left: 20px;
            right: auto;
        }

        [dir="ltr"] .form-group {
            text-align: left;
        }

        [dir="rtl"] .close {
            right: 1rem;
            left: auto;
        }

        [dir="ltr"] .close {
            left: auto;
            right: 1rem;
        }

        /* تحسينات للأجهزة المحمولة */
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header-content { padding: 0 10px; }
            h1 { font-size: 1.5rem; }
            .nav-tabs { flex-direction: column; }
            .tab-btn { min-width: auto; padding: 16px 20px; font-size: 1rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .tab-content { padding: 1rem; }
            table { font-size: 0.7rem; }
            th, td { padding: 6px 4px; min-width: 80px; }
            .login-form { padding: 2rem; margin: 1rem; }
            .login-language-switcher { top: 10px; right: 10px; }
            input, select, textarea { font-size: 16px; padding: 12px; }
            .btn { padding: 12px 20px; font-size: 1rem; min-height: 44px; }
            .bulk-actions { flex-direction: column; align-items: stretch; }
            .action-buttons { flex-direction: column; }
            .modal-content { width: 95%; margin: 2% auto; padding: 1rem; }
            .form-row-2, .form-row-3 { grid-template-columns: 1fr; }
            .action-select { min-width: 100px; font-size: 0.7rem; }
        }
    </style>
</head>
<body>
    <!-- شاشة تسجيل الدخول -->
    <div id="loginScreen" class="login-container">
        <div class="login-language-switcher">
            <select id="loginLanguageSelect" onchange="changeLanguageFromLogin(this.value)">
                <option value="ar">العربية</option>
                <option value="en">English</option>
                <option value="pl">Polski</option>
            </select>
        </div>
        
        <div class="login-form">
            <h2 id="loginTitle">تسجيل دخول الأدمين</h2>
            <div class="message error" id="loginError"></div>
            <div class="message success" id="loginSuccess"></div>
            
            <!-- بيانات تجريبية للدخول -->
            <div class="demo-credentials" id="demoCredentials">
                <h4 id="demoTitle">بيانات تجريبية للدخول:</h4>
                <p><strong id="demoUser">المستخدم:</strong> admin</p>
                <p><strong id="demoPass">كلمة المرور:</strong> 123456</p>
                <button class="btn" onclick="fillDemoCredentials()" style="width: 100%; margin-top: 0.5rem;" id="useDemoBtn">
                    استخدام البيانات التجريبية
                </button>
            </div>
            
            <!-- نموذج تسجيل الدخول -->
            <form id="loginForm" style="display: block;">
                <div class="form-group">
                    <label id="usernameOrEmailLabel">اسم المستخدم أو البريد الإلكتروني:</label>
                    <input type="text" id="loginUsernameEmail" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label id="passwordLabel">كلمة المرور:</label>
                    <input type="password" id="loginPassword" required autocomplete="current-password">
                </div>
                <button type="submit" id="loginButton" style="width: 100%;">دخول</button>
            </form>
            
            <!-- نموذج إنشاء حساب -->
            <form id="registerForm" style="display: none;">
                <div class="form-group">
                    <label id="registerUsernameLabel">اسم المستخدم:</label>
                    <input type="text" id="registerUsername" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label id="registerEmailLabel">البريد الإلكتروني:</label>
                    <input type="email" id="registerEmail" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label id="registerPasswordLabel">كلمة المرور:</label>
                    <input type="password" id="registerPassword" required autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label id="registerPasswordConfirmLabel">تأكيد كلمة المرور:</label>
                    <input type="password" id="registerPasswordConfirm" required autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label id="registerFullNameLabel">الاسم الكامل:</label>
                    <input type="text" id="registerFullName" required autocomplete="name">
                </div>
                <button type="submit" id="registerButton" style="width: 100%;">إنشاء الحساب</button>
            </form>
            
            <!-- نموذج استرجاع كلمة المرور -->
            <form id="forgotForm" style="display: none;">
                <div class="form-group">
                    <label id="forgotUsernameEmailLabel">اسم المستخدم أو البريد الإلكتروني:</label>
                    <input type="text" id="forgotUsernameEmail" required>
                </div>
                <button type="submit" id="forgotButton" style="width: 100%;">إرسال كلمة المرور</button>
            </form>
            
            <div style="margin-top: 1rem; text-align: center;">
                <button class="link-btn" id="showRegisterBtn">إنشاء حساب جديد</button> |
                <button class="link-btn" id="showForgotBtn">نسيت كلمة المرور؟</button> |
                <button class="link-btn" id="showLoginBtn" style="display: none;">العودة لتسجيل الدخول</button>
            </div>
            
            <div style="margin-top: 1rem; font-size: 0.8rem; color: #666; text-align: center;">
                <p id="loginNote">يمكنك تثبيت هذا التطبيق على جهازك كتطبيق منفصل</p>
            </div>
        </div>
    </div>

    <!-- الواجهة الرئيسية -->
    <div id="mainApp" class="container" style="display: none;">
        <header>
            <div class="header-content">
                <h1 id="pageTitle">نظام إدارة المتجر</h1>
                <div class="header-right" style="display: flex; align-items: center; gap: 1rem;">
                    <div class="user-info">
                        <span id="currentUserDisplay">المدير</span>
                        <span class="admin-badge" id="adminBadge">أدمين</span>
                        <button class="btn btn-danger" onclick="logout()" style="padding: 6px 12px; font-size: 0.8rem;" id="logoutBtn">خروج</button>
                    </div>
                    <div id="currentTime"></div>
                    <div class="language-switcher">
                        <select id="languageSelect" onchange="changeLanguageFromMain(this.value)">
                            <option value="ar">العربية</option>
                            <option value="en">English</option>
                            <option value="pl">Polski</option>
                        </select>
                    </div>
                </div>
            </div>
        </header>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('dashboard')" data-translate="tabs.0">لوحة التحكم</button>
            <button class="tab-btn" onclick="showTab('products')" data-translate="tabs.1">المنتجات</button>
            <button class="tab-btn" onclick="showTab('orders')" data-translate="tabs.2">الطلبات</button>
            <button class="tab-btn" onclick="showTab('customers')" data-translate="tabs.3">العملاء</button>
            <button class="tab-btn" onclick="showTab('reports')" data-translate="tabs.4">التقارير</button>
            <button class="tab-btn" onclick="showTab('email')" data-translate="tabs.5">البريد الإلكتروني</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2 data-translate="dashboard.title">لوحة التحكم</h2>

            <!-- البحث السريع -->
            <div class="quick-search">
                <h4 data-translate="dashboard.quickSearch">البحث السريع في الطلبات</h4>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="form-group">
                        <label data-translate="dashboard.searchByOrderId">البحث برقم الطلب:</label>
                        <input type="text" id="quickSearchOrderId" placeholder="#123456" onkeyup="quickSearchOrders()">
                    </div>
                    <div class="form-group">
                        <label data-translate="dashboard.searchByCustomer">البحث باسم العميل:</label>
                        <input type="text" id="quickSearchCustomer" placeholder="اسم العميل" onkeyup="quickSearchOrders()">
                    </div>
                </div>
                <div class="search-results" id="quickSearchResults"></div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalProducts">0</div>
                    <div class="stat-label" data-translate="dashboard.totalProducts">إجمالي المنتجات</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalOrders">0</div>
                    <div class="stat-label" data-translate="dashboard.totalOrders">إجمالي الطلبات</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalCustomers">0</div>
                    <div class="stat-label" data-translate="dashboard.totalCustomers">إجمالي العملاء</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalRevenue">0</div>
                    <div class="stat-label" data-translate="dashboard.totalRevenue">إجمالي الإيرادات</div>
                </div>
            </div>

            <div class="card">
                <h3 data-translate="dashboard.recentOrders">الطلبات الحديثة</h3>
                <div id="recentOrders"></div>
            </div>

            <div class="card">
                <h3 data-translate="dashboard.recentProducts">المنتجات الحديثة</h3>
                <div id="recentProducts"></div>
            </div>
        </div>

        <!-- Products Tab -->
        <div id="products" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                <h2 data-translate="products.manageProducts">إدارة المنتجات</h2>
                <button class="btn" onclick="showAddProductForm()" data-translate="products.addNewProduct">إضافة منتج جديد</button>
            </div>

            <div style="margin-bottom: 1rem;">
                <input type="text" id="productSearch" style="width: 100%; max-width: 400px; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px;" data-translate="products.searchPlaceholder" placeholder="البحث في المنتجات..." onkeyup="searchProducts()">
            </div>

            <div id="productsContainer"></div>
        </div>

        <!-- Orders Tab -->
        <div id="orders" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 data-translate="orders.manageOrders">إدارة الطلبات</h2>
            </div>
            
            <!-- جدول إضافة الطلبات الجديد -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
                    <h4 data-translate="orders.addNewOrderTable">إضافة طلبات جديدة</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn" onclick="addNewOrderRow()" data-translate="orders.addRow">إضافة صف</button>
                        <button class="btn btn-success" onclick="saveAllNewOrders()" data-translate="orders.saveAll">حفظ الكل</button>
                        <button class="btn btn-danger" onclick="clearNewOrders()" data-translate="orders.clearAll">مسح الكل</button>
                    </div>
                </div>
                <div style="overflow-x: auto;">
                    <table id="newOrdersTable">
                        <thead>
                            <tr>
                                <th data-translate="orders.orderId">رقم الطلب</th>
                                <th data-translate="orders.customerName">اسم العميل</th>
                                <th data-translate="orders.customerPhone">رقم الهاتف</th>
                                <th data-translate="orders.customerEmail">البريد الإلكتروني</th>
                                <th data-translate="orders.customerAddress">العنوان</th>
                                <th data-translate="orders.productName">المنتج</th>
                                <th data-translate="orders.orderDate">تاريخ الطلب</th>
                                <th data-translate="orders.totalAmount">المبلغ الإجمالي</th>
                                <th data-translate="orders.currency">العملة</th>
                                <th data-translate="orders.paymentStatus">حالة الدفع</th>
                                <th data-translate="orders.remainingAmount">المبلغ المتبقي</th>
                                <th data-translate="orders.shippingMethod">طريقة الإرسال</th>
                                <th data-translate="orders.shippingDate">تاريخ الإرسال</th>
                                <th data-translate="orders.orderStatus">حالة الطلب</th>
                                <th data-translate="orders.actions">الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="newOrdersBody">
                            <!-- الصفوف الجديدة ستُضاف هنا -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- إدارة البيانات -->
            <div class="export-section">
                <h4 data-translate="orders.dataManagement">إدارة البيانات</h4>
                <div class="bulk-actions">
                    <button class="btn btn-excel" onclick="exportAllToExcel()" data-translate="orders.exportExcel">تصدير Excel</button>
                    <button class="btn btn-pdf" onclick="exportAllToPDF()" data-translate="orders.exportPDF">تصدير PDF</button>
                    <button class="btn btn-success" onclick="exportAllToJSON()" data-translate="orders.exportJSON">تصدير JSON</button>
                    <button class="btn" onclick="printAllOrders()" data-translate="orders.print">طباعة</button>
                    <button class="btn btn-whatsapp" onclick="sendAllToWhatsApp()" data-translate="orders.sendAllWhatsApp">إرسال الكل واتساب</button>
                    <button class="btn btn-email" onclick="sendAllOrdersByEmail()" data-translate="orders.sendAllEmail">إرسال الكل بالإيميل</button>
                    <input type="file" id="importFile" accept=".json,.csv" style="display: none;" onchange="importData()">
                    <button class="btn btn-warning" onclick="document.getElementById('importFile').click()" data-translate="orders.import">استيراد بيانات</button>
                </div>
            </div>

            <div style="margin-bottom: 1rem;">
                <input type="text" id="orderSearch" style="width: 100%; max-width: 400px; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px;" data-translate="orders.searchPlaceholder" placeholder="البحث في الطلبات..." onkeyup="searchOrders()">
            </div>

            <div id="ordersContainer"></div>
        </div>

        <!-- Customers Tab -->
        <div id="customers" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                <h2 data-translate="customers.manageCustomers">إدارة العملاء</h2>
                <button class="btn" onclick="showAddCustomerForm()" data-translate="customers.addNewCustomer">إضافة عميل جديد</button>
            </div>

            <div style="margin-bottom: 1rem;">
                <input type="text" id="customerSearch" style="width: 100%; max-width: 400px; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px;" data-translate="customers.searchPlaceholder" placeholder="البحث في العملاء..." onkeyup="searchCustomers()">
            </div>

            <div id="customersContainer"></div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2 data-translate="reports.title">التقارير والإحصائيات</h2>
            
            <div class="form-row-3">
                <div class="form-group">
                    <label data-translate="reports.fromDate">من تاريخ:</label>
                    <input type="date" id="reportFromDate">
                </div>
                <div class="form-group">
                    <label data-translate="reports.toDate">إلى تاريخ:</label>
                    <input type="date" id="reportToDate">
                </div>
                <div class="form-group">
                    <button class="btn" onclick="generateReport()" style="margin-top: 1.7rem;" data-translate="reports.generateReport">إنشاء التقرير</button>
                </div>
            </div>

            <div id="reportResults"></div>
        </div>

        <!-- Email Tab -->
        <div id="email" class="tab-content">
            <h2 data-translate="email.title">إدارة البريد الإلكتروني</h2>

            <!-- Email Configuration -->
            <div class="email-config">
                <h4 data-translate="email.configuration">إعدادات البريد الإلكتروني</h4>
                <div class="form-row-2">
                    <div class="form-group">
                        <label data-translate="email.publicKey">مفتاح EmailJS العام:</label>
                        <input type="text" id="emailjsPublicKey" placeholder="your_public_key">
                    </div>
                    <div class="form-group">
                        <label data-translate="email.templateId">معرف القالب:</label>
                        <input type="text" id="emailjsTemplateId" placeholder="your_template_id">
                    </div>
                </div>
                <div class="form-group">
                    <button class="btn btn-email" onclick="saveEmailConfig()" data-translate="email.saveConfig">حفظ الإعدادات</button>
                    <button class="btn" onclick="testEmailConnection()" data-translate="email.testConnection">اختبار الاتصال</button>
                    <span id="emailConnectionStatus" class="email-status" style="display: none;"></span>
                </div>
            </div>

            <!-- Email Actions -->
            <div class="email-section">
                <h4 data-translate="email.actions">إجراءات البريد الإلكتروني</h4>
                <div class="bulk-actions">
                    <button class="btn btn-email" onclick="sendOrdersByEmail()" data-translate="email.sendOrders">إرسال الطلبات</button>
                    <button class="btn btn-email" onclick="sendCustomersByEmail()" data-translate="email.sendCustomers">إرسال العملاء</button>
                    <button class="btn btn-email" onclick="sendProductsByEmail()" data-translate="email.sendProducts">إرسال المنتجات</button>
                    <button class="btn btn-email" onclick="sendReportByEmail()" data-translate="email.sendReport">إرسال تقرير مخصص</button>
                </div>
            </div>

            <!-- Email Sending Form -->
            <div class="card">
                <h4 data-translate="email.sendCustomEmail">إرسال إيميل مخصص</h4>
                <form id="customEmailForm">
                    <div class="form-row-2">
                        <div class="form-group">
                            <label data-translate="email.toEmail">إلى (البريد الإلكتروني):</label>
                            <input type="email" id="customEmailTo" required>
                        </div>
                        <div class="form-group">
                            <label data-translate="email.subject">الموضوع:</label>
                            <input type="text" id="customEmailSubject" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label data-translate="email.message">الرسالة:</label>
                        <textarea id="customEmailMessage" rows="6" required></textarea>
                    </div>
                    <div style="text-align: center;">
                        <button type="submit" class="btn btn-email" data-translate="email.sendMessage">إرسال الرسالة</button>
                    </div>
                </form>
            </div>

            <!-- Email History -->
            <div class="card">
                <h4 data-translate="email.history">سجل الإيميلات المرسلة</h4>
                <div id="emailHistory"></div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('productModal')">&times;</span>
            <h3 id="productModalTitle" data-translate="products.addProductTitle">إضافة منتج جديد</h3>
            <form id="productForm">
                <div class="form-row-2">
                    <div class="form-group">
                        <label data-translate="products.productName">اسم المنتج:</label>
                        <input type="text" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="products.productPrice">السعر:</label>
                        <input type="number" id="productPrice" step="0.01" min="0" required>
                    </div>
                </div>
                <div class="form-group">
                    <label data-translate="products.productDescription">الوصف:</label>
                    <textarea id="productDescription" rows="3"></textarea>
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn" data-translate="products.saveProduct">حفظ المنتج</button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('productModal')" data-translate="products.cancel">إلغاء</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('customerModal')">&times;</span>
            <h3 data-translate="customers.addCustomerTitle">إضافة عميل جديد</h3>
            <form id="customerForm">
                <div class="form-row-2">
                    <div class="form-group">
                        <label data-translate="customers.customerName">اسم العميل:</label>
                        <input type="text" id="customerName" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="customers.customerPhone">رقم الهاتف:</label>
                        <input type="tel" id="customerPhone" required>
                    </div>
                </div>
                <div class="form-row-2">
                    <div class="form-group">
                        <label data-translate="customers.customerEmail">البريد الإلكتروني:</label>
                        <input type="email" id="customerEmail">
                    </div>
                    <div class="form-group">
                        <label data-translate="customers.customerAddress">العنوان:</label>
                        <input type="text" id="customerAddress">
                    </div>
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn" data-translate="customers.saveCustomer">حفظ العميل</button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('customerModal')" data-translate="customers.cancel">إلغاء</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Order Modal -->
    <div id="editOrderModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editOrderModal')">&times;</span>
            <h3 id="editOrderModalTitle" data-translate="orders.editOrderTitle">تعديل الطلب</h3>
            <form id="editOrderForm">
                <div class="form-row-2">
                    <div class="form-group">
                        <label data-translate="orders.orderId">رقم الطلب:</label>
                        <input type="text" id="editOrderId" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label data-translate="orders.customerName">اسم العميل:</label>
                        <input type="text" id="editCustomerName" required>
                    </div>
                </div>
                <div class="form-row-2">
                    <div class="form-group">
                        <label data-translate="orders.customerPhone">رقم الهاتف:</label>
                        <input type="tel" id="editCustomerPhone" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="orders.customerEmail">البريد الإلكتروني:</label>
                        <input type="email" id="editCustomerEmail">
                    </div>
                </div>
                <div class="form-group">
                    <label data-translate="orders.customerAddress">العنوان:</label>
                    <input type="text" id="editCustomerAddress" required>
                </div>
                <div class="form-row-2">
                    <div class="form-group">
                        <label data-translate="orders.productName">المنتج:</label>
                        <input type="text" id="editProductName" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="orders.orderDate">تاريخ الطلب:</label>
                        <input type="date" id="editOrderDate" required>
                    </div>
                </div>
                <div class="form-row-2">
                    <div class="form-group">
                        <label data-translate="orders.totalAmount">المبلغ الإجمالي:</label>
                        <input type="number" id="editTotalAmount" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="orders.currency">العملة:</label>
                        <select id="editCurrency" required>
                            <option value="SAR">ريال سعودي (SAR)</option>
                            <option value="USD">دولار أمريكي (USD)</option>
                            <option value="EUR">يورو (EUR)</option>
                            <option value="PLN">زلوتي بولندي (PLN)</option>
                        </select>
                    </div>
                </div>
                <div class="form-row-2">
                    <div class="form-group">
                        <label data-translate="orders.paymentStatus">حالة الدفع:</label>
                        <input type="text" id="editPaymentStatus" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="orders.remainingAmount">المبلغ المتبقي:</label>
                        <input type="number" id="editRemainingAmount" step="0.01" min="0">
                    </div>
                </div>
                <div class="form-row-2">
                    <div class="form-group">
                        <label data-translate="orders.shippingMethod">طريقة الإرسال:</label>
                        <input type="text" id="editShippingMethod" required>
                    </div>
                    <div class="form-group">
                        <label data-translate="orders.shippingDate">تاريخ الإرسال:</label>
                        <input type="date" id="editShippingDate">
                    </div>
                </div>
                <div class="form-group">
                    <label data-translate="orders.orderStatus">حالة الطلب:</label>
                    <input type="text" id="editOrderStatus" required>
                </div>
                <div style="text-align: center;">
                    <button type="submit" class="btn" data-translate="orders.saveOrder">حفظ التعديلات</button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('editOrderModal')" data-translate="orders.cancel">إلغاء</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // تهيئة EmailJS
        emailjs.init("YOUR_PUBLIC_KEY"); // سيتم استبداله بالمفتاح الحقيقي

        // ترجمة النصوص لكل لغة
        const translations = {
            ar: {
                dir: 'rtl',
                title: 'نظام إدارة المتجر',
                tabs: ['لوحة التحكم', 'المنتجات', 'الطلبات', 'العملاء', 'التقارير', 'البريد الإلكتروني'],
                login: {
                    title: 'تسجيل دخول الأدمين',
                    registerTitle: 'إنشاء حساب أدمين جديد',
                    forgotTitle: 'استرجاع كلمة المرور',
                    usernameOrEmail: 'اسم المستخدم أو البريد الإلكتروني:',
                    password: 'كلمة المرور:',
                    username: 'اسم المستخدم:',
                    email: 'البريد الإلكتروني:',
                    fullName: 'الاسم الكامل:',
                    confirmPassword: 'تأكيد كلمة المرور:',
                    loginButton: 'دخول',
                    registerButton: 'إنشاء الحساب',
                    forgotButton: 'إرسال كلمة المرور',
                    createAccount: 'إنشاء حساب جديد',
                    forgotPassword: 'نسيت كلمة المرور؟',
                    backToLogin: 'العودة لتسجيل الدخول',
                    demoTitle: 'بيانات تجريبية للدخول:',
                    demoUser: 'المستخدم:',
                    demoPass: 'كلمة المرور:',
                    useDemoBtn: 'استخدام البيانات التجريبية',
                    installNote: 'يمكنك تثبيت هذا التطبيق على جهازك كتطبيق منفصل'
                },
                dashboard: {
                    title: 'لوحة التحكم',
                    totalProducts: 'إجمالي المنتجات',
                    totalOrders: 'إجمالي الطلبات',
                    totalCustomers: 'إجمالي العملاء',
                    totalRevenue: 'إجمالي الإيرادات',
                    recentOrders: 'الطلبات الحديثة',
                    recentProducts: 'المنتجات الحديثة',
                    noRecentOrders: 'لا توجد طلبات حديثة',
                    noRecentProducts: 'لا توجد منتجات حديثة',
                    quickSearch: 'البحث السريع في الطلبات',
                    searchByOrderId: 'البحث برقم الطلب:',
                    searchByCustomer: 'البحث باسم العميل:',
                    noSearchResults: 'لا توجد نتائج للبحث'
                },
                products: {
                    manageProducts: 'إدارة المنتجات',
                    addNewProduct: 'إضافة منتج جديد',
                    addProductTitle: 'إضافة منتج جديد',
                    editProductTitle: 'تعديل المنتج',
                    productName: 'اسم المنتج:',
                    productPrice: 'السعر:',
                    productDescription: 'الوصف:',
                    saveProduct: 'حفظ المنتج',
                    cancel: 'إلغاء',
                    searchPlaceholder: 'البحث في المنتجات...',
                    tableHeaders: ['اسم المنتج', 'السعر', 'الوصف', 'تاريخ الإضافة', 'الإجراءات'],
                    edit: 'تعديل',
                    delete: 'حذف',
                    noProducts: 'لا توجد منتجات',
                    addProductsPrompt: 'ابدأ بإضافة منتجات جديدة لمتجرك',
                    selectAction: 'اختر الإجراء'
                },
                orders: {
                    manageOrders: 'إدارة الطلبات',
                    addNewOrderTable: 'إضافة طلبات جديدة',
                    editOrderTitle: 'تعديل الطلب',
                    addRow: 'إضافة صف',
                    saveAll: 'حفظ الكل',
                    clearAll: 'مسح الكل',
                    saveOrder: 'حفظ التعديلات',
                    cancel: 'إلغاء',
                    actions: 'الإجراءات',
                    searchPlaceholder: 'البحث في الطلبات...',
                    dataManagement: 'إدارة البيانات',
                    exportExcel: 'تصدير Excel',
                    exportPDF: 'تصدير PDF',
                    exportJSON: 'تصدير JSON',
                    print: 'طباعة',
                    import: 'استيراد بيانات',
                    whatsapp: 'واتساب',
                    copy: 'نسخ',
                    view: 'عرض',
                    edit: 'تعديل',
                    delete: 'مسح',
                    sendAllWhatsApp: 'إرسال الكل واتساب',
                    sendAllEmail: 'إرسال الكل بالإيميل',
                    selectAction: 'اختر الإجراء',
                    orderId: 'رقم الطلب',
                    customerName: 'اسم العميل',
                    customerPhone: 'رقم الهاتف',
                    customerEmail: 'البريد الإلكتروني',
                    customerAddress: 'العنوان',
                    productName: 'المنتج',
                    orderDate: 'تاريخ الطلب',
                    totalAmount: 'المبلغ الإجمالي',
                    currency: 'العملة',
                    orderStatus: 'حالة الطلب',
                    paymentStatus: 'حالة الدفع',
                    remainingAmount: 'المبلغ المتبقي',
                    shippingMethod: 'طريقة الإرسال',
                    shippingDate: 'تاريخ الإرسال',
                    noOrders: 'لا توجد طلبات',
                    addOrdersPrompt: 'سيتم عرض الطلبات هنا عند إضافتها'
                },
                customers: {
                    manageCustomers: 'إدارة العملاء',
                    addNewCustomer: 'إضافة عميل جديد',
                    addCustomerTitle: 'إضافة عميل جديد',
                    customerName: 'اسم العميل:',
                    customerPhone: 'رقم الهاتف:',
                    customerEmail: 'البريد الإلكتروني:',
                    customerAddress: 'العنوان:',
                    saveCustomer: 'حفظ العميل',
                    cancel: 'إلغاء',
                    searchPlaceholder: 'البحث في العملاء...',
                    tableHeaders: ['اسم العميل', 'رقم الهاتف', 'البريد الإلكتروني', 'العنوان', 'تاريخ التسجيل', 'الإجراءات'],
                    delete: 'حذف',
                    selectAction: 'اختر الإجراء',
                    noEmail: 'غير متوفر',
                    noCustomers: 'لا يوجد عملاء',
                    addCustomerPrompt: 'ابدأ بإضافة عملاء جدد'
                },
                reports: {
                    title: 'التقارير والإحصائيات',
                    fromDate: 'من تاريخ:',
                    toDate: 'إلى تاريخ:',
                    generateReport: 'إنشاء التقرير',
                    reportTitle: 'تقرير المبيعات من',
                    to: 'إلى',
                    totalOrders: 'إجمالي الطلبات',
                    completedOrders: 'الطلبات المكتملة',
                    totalRevenue: 'إجمالي الإيرادات',
                    avgOrderValue: 'متوسط قيمة الطلب',
                    bestSellingProducts: 'أفضل المنتجات مبيعاً',
                    productName: 'المنتج',
                    quantitySold: 'عدد الطلبات',
                    noSales: 'لا توجد مبيعات في هذه الفترة',
                    topCustomers: 'أفضل العملاء',
                    customerOrders: 'عدد الطلبات',
                    monthlySales: 'المبيعات الشهرية',
                    month: 'الشهر',
                    sales: 'المبيعات'
                },
                email: {
                    title: 'إدارة البريد الإلكتروني',
                    configuration: 'إعدادات البريد الإلكتروني',
                    publicKey: 'مفتاح EmailJS العام:',
                    templateId: 'معرف القالب:',
                    saveConfig: 'حفظ الإعدادات',
                    testConnection: 'اختبار الاتصال',
                    actions: 'إجراءات البريد الإلكتروني',
                    sendOrders: 'إرسال الطلبات',
                    sendCustomers: 'إرسال العملاء',
                    sendProducts: 'إرسال المنتجات',
                    sendReport: 'إرسال تقرير مخصص',
                    sendCustomEmail: 'إرسال إيميل مخصص',
                    toEmail: 'إلى (البريد الإلكتروني):',
                    subject: 'الموضوع:',
                    message: 'الرسالة:',
                    sendMessage: 'إرسال الرسالة',
                    history: 'سجل الإيميلات المرسلة',
                    connectionSuccess: 'تم الاتصال بنجاح',
                    connectionError: 'خطأ في الاتصال',
                    emailSent: 'تم إرسال الإيميل بنجاح',
                    emailError: 'خطأ في إرسال الإيميل'
                },
                alerts: {
                    fillRequiredFields: 'يرجى ملء جميع الحقول المطلوبة',
                    invalidCredentials: 'اسم المستخدم أو كلمة المرور غير صحيحة',
                    logoutConfirm: 'هل أنت متأكد من تسجيل الخروج؟',
                    confirmDeleteOrder: 'هل أنت متأكد من حذف هذا الطلب؟',
                    confirmDeleteProduct: 'هل أنت متأكد من حذف هذا المنتج؟',
                    confirmDeleteCustomer: 'هل أنت متأكد من حذف هذا العميل؟',
                    ordersSaved: 'تم حفظ جميع الطلبات بنجاح',
                    orderUpdated: 'تم تحديث الطلب بنجاح',
                    productSaved: 'تم حفظ المنتج بنجاح',
                    customerSaved: 'تم حفظ العميل بنجاح',
                    dataCopied: 'تم نسخ البيانات',
                    selectDates: 'يرجى تحديد تاريخ البداية والنهاية',
                    accountCreated: 'تم إنشاء الحساب بنجاح، يمكنك الآن تسجيل الدخول',
                    passwordSentEmail: 'تم إرسال كلمة المرور إلى البريد الإلكتروني',
                    emailNotFound: 'البريد الإلكتروني أو اسم المستخدم غير موجود',
                    usernameExists: 'اسم المستخدم مستخدم بالفعل',
                    emailExists: 'البريد الإلكتروني مستخدم بالفعل',
                    invalidEmail: 'يرجى إدخال بريد إلكتروني صالح',
                    passwordMismatch: 'كلمتا المرور غير متطابقتان',
                    weakPassword: 'كلمة المرور يجب أن تكون 6 أحرف على الأقل',
                    emailConfigSaved: 'تم حفظ إعدادات الإيميل بنجاح',
                    emailConfigRequired: 'يرجى إعداد بيانات EmailJS أولاً'
                }
            },
            en: {
                dir: 'ltr',
                title: 'Store Management System',
                tabs: ['Dashboard', 'Products', 'Orders', 'Customers', 'Reports', 'Email'],
                login: {
                    title: 'Admin Login',
                    registerTitle: 'Create New Admin Account',
                    forgotTitle: 'Password Recovery',
                    usernameOrEmail: 'Username or Email:',
                    password: 'Password:',
                    username: 'Username:',
                    email: 'Email:',
                    fullName: 'Full Name:',
                    confirmPassword: 'Confirm Password:',
                    loginButton: 'Login',
                    registerButton: 'Create Account',
                    forgotButton: 'Send Password',
                    createAccount: 'Create New Account',
                    forgotPassword: 'Forgot Password?',
                    backToLogin: 'Back to Login',
                    demoTitle: 'Demo Login Credentials:',
                    demoUser: 'Username:',
                    demoPass: 'Password:',
                    useDemoBtn: 'Use Demo Credentials',
                    installNote: 'You can install this app on your device as a standalone app'
                },
                dashboard: {
                    title: 'Dashboard',
                    totalProducts: 'Total Products',
                    totalOrders: 'Total Orders',
                    totalCustomers: 'Total Customers',
                    totalRevenue: 'Total Revenue',
                    recentOrders: 'Recent Orders',
                    recentProducts: 'Recent Products',
                    noRecentOrders: 'No recent orders',
                    noRecentProducts: 'No recent products',
                    quickSearch: 'Quick Order Search',
                    searchByOrderId: 'Search by Order ID:',
                    searchByCustomer: 'Search by Customer Name:',
                    noSearchResults: 'No search results found'
                },
                products: {
                    manageProducts: 'Manage Products',
                    addNewProduct: 'Add New Product',
                    addProductTitle: 'Add New Product',
                    editProductTitle: 'Edit Product',
                    productName: 'Product Name:',
                    productPrice: 'Price:',
                    productDescription: 'Description:',
                    saveProduct: 'Save Product',
                    cancel: 'Cancel',
                    searchPlaceholder: 'Search products...',
                    tableHeaders: ['Product Name', 'Price', 'Description', 'Date Added', 'Actions'],
                    edit: 'Edit',
                    delete: 'Delete',
                    noProducts: 'No products',
                    addProductsPrompt: 'Start by adding new products to your store',
                    selectAction: 'Select Action'
                },
                orders: {
                    manageOrders: 'Manage Orders',
                    addNewOrderTable: 'Add New Orders',
                    editOrderTitle: 'Edit Order',
                    addRow: 'Add Row',
                    saveAll: 'Save All',
                    clearAll: 'Clear All',
                    saveOrder: 'Save Changes',
                    cancel: 'Cancel',
                    actions: 'Actions',
                    searchPlaceholder: 'Search orders...',
                    dataManagement: 'Data Management',
                    exportExcel: 'Export Excel',
                    exportPDF: 'Export PDF',
                    exportJSON: 'Export JSON',
                    print: 'Print',
                    import: 'Import Data',
                    whatsapp: 'WhatsApp',
                    copy: 'Copy',
                    view: 'View',
                    edit: 'Edit',
                    delete: 'Delete',
                    sendAllWhatsApp: 'Send All WhatsApp',
                    sendAllEmail: 'Send All via Email',
                    selectAction: 'Select Action',
                    orderId: 'Order ID',
                    customerName: 'Customer Name',
                    customerPhone: 'Phone Number',
                    customerEmail: 'Email',
                    customerAddress: 'Address',
                    productName: 'Product Name',
                    orderDate: 'Order Date',
                    totalAmount: 'Total Amount',
                    currency: 'Currency',
                    orderStatus: 'Order Status',
                    paymentStatus: 'Payment Status',
                    remainingAmount: 'Remaining Amount',
                    shippingMethod: 'Shipping Method',
                    shippingDate: 'Shipping Date',
                    noOrders: 'No orders',
                    addOrdersPrompt: 'Orders will be displayed here when added'
                },
                customers: {
                    manageCustomers: 'Manage Customers',
                    addNewCustomer: 'Add New Customer',
                    addCustomerTitle: 'Add New Customer',
                    customerName: 'Customer Name:',
                    customerPhone: 'Phone Number:',
                    customerEmail: 'Email:',
                    customerAddress: 'Address:',
                    saveCustomer: 'Save Customer',
                    cancel: 'Cancel',
                    searchPlaceholder: 'Search customers...',
                    tableHeaders: ['Customer Name', 'Phone Number', 'Email', 'Address', 'Registration Date', 'Actions'],
                    delete: 'Delete',
                    selectAction: 'Select Action',
                    noEmail: 'N/A',
                    noCustomers: 'No customers',
                    addCustomerPrompt: 'Start adding new customers'
                },
                reports: {
                    title: 'Reports & Statistics',
                    fromDate: 'From Date:',
                    toDate: 'To Date:',
                    generateReport: 'Generate Report',
                    reportTitle: 'Sales Report from',
                    to: 'to',
                    totalOrders: 'Total Orders',
                    completedOrders: 'Completed Orders',
                    totalRevenue: 'Total Revenue',
                    avgOrderValue: 'Average Order Value',
                    bestSellingProducts: 'Best Selling Products',
                    productName: 'Product',
                    quantitySold: 'Order Count',
                    noSales: 'No sales in this period',
                    topCustomers: 'Top Customers',
                    customerOrders: 'Order Count',
                    monthlySales: 'Monthly Sales',
                    month: 'Month',
                    sales: 'Sales'
                },
                email: {
                    title: 'Email Management',
                    configuration: 'Email Configuration',
                    publicKey: 'EmailJS Public Key:',
                    templateId: 'Template ID:',
                    saveConfig: 'Save Configuration',
                    testConnection: 'Test Connection',
                    actions: 'Email Actions',
                    sendOrders: 'Send Orders',
                    sendCustomers: 'Send Customers',
                    sendProducts: 'Send Products',
                    sendReport: 'Send Custom Report',
                    sendCustomEmail: 'Send Custom Email',
                    toEmail: 'To (Email):',
                    subject: 'Subject:',
                    message: 'Message:',
                    sendMessage: 'Send Message',
                    history: 'Email History',
                    connectionSuccess: 'Connection successful',
                    connectionError: 'Connection error',
                    emailSent: 'Email sent successfully',
                    emailError: 'Error sending email'
                },
                alerts: {
                    fillRequiredFields: 'Please fill in all required fields',
                    invalidCredentials: 'Invalid username or password',
                    logoutConfirm: 'Are you sure you want to logout?',
                    confirmDeleteOrder: 'Are you sure you want to delete this order?',
                    confirmDeleteProduct: 'Are you sure you want to delete this product?',
                    confirmDeleteCustomer: 'Are you sure you want to delete this customer?',
                    ordersSaved: 'All orders saved successfully',
                    orderUpdated: 'Order updated successfully',
                    productSaved: 'Product saved successfully',
                    customerSaved: 'Customer saved successfully',
                    dataCopied: 'Data copied to clipboard',
                    selectDates: 'Please select start and end dates',
                    accountCreated: 'Account created successfully, you can now login',
                    passwordSentEmail: 'Password sent to email address',
                    emailNotFound: 'Email or username not found',
                    usernameExists: 'Username already exists',
                    emailExists: 'Email already exists',
                    invalidEmail: 'Please enter a valid email address',
                    passwordMismatch: 'Passwords do not match',
                    weakPassword: 'Password must be at least 6 characters',
                    emailConfigSaved: 'Email configuration saved successfully',
                    emailConfigRequired: 'Please configure EmailJS settings first'
                }
            },
            pl: {
                dir: 'ltr',
                title: 'System Zarządzania Sklepem',
                tabs: ['Pulpit', 'Produkty', 'Zamówienia', 'Klienci', 'Raporty', 'Email'],
                login: {
                    title: 'Logowanie Administratora',
                    registerTitle: 'Utwórz nowe konto administratora',
                    forgotTitle: 'Odzyskiwanie hasła',
                    usernameOrEmail: 'Nazwa użytkownika lub email:',
                    password: 'Hasło:',
                    username: 'Nazwa użytkownika:',
                    email: 'Email:',
                    fullName: 'Imię i nazwisko:',
                    confirmPassword: 'Potwierdź hasło:',
                    loginButton: 'Zaloguj',
                    registerButton: 'Utwórz konto',
                    forgotButton: 'Wyślij hasło',
                    createAccount: 'Utwórz nowe konto',
                    forgotPassword: 'Zapomniałeś hasła?',
                    backToLogin: 'Powrót do logowania',
                    demoTitle: 'Dane demonstracyjne do logowania:',
                    demoUser: 'Użytkownik:',
                    demoPass: 'Hasło:',
                    useDemoBtn: 'Użyj danych demonstracyjnych',
                    installNote: 'Możesz zainstalować tę aplikację na swoim urządzeniu jako samodzielną aplikację'
                },
                dashboard: {
                    title: 'Pulpit',
                    totalProducts: 'Łączna liczba produktów',
                    totalOrders: 'Łączna liczba zamówień',
                    totalCustomers: 'Łączna liczba klientów',
                    totalRevenue: 'Łączny przychód',
                    recentOrders: 'Ostatnie zamówienia',
                    recentProducts: 'Ostatnie produkty',
                    noRecentOrders: 'Brak ostatnich zamówień',
                    noRecentProducts: 'Brak ostatnich produktów',
                    quickSearch: 'Szybkie wyszukiwanie zamówień',
                    searchByOrderId: 'Szukaj według ID zamówienia:',
                    searchByCustomer: 'Szukaj według nazwy klienta:',
                    noSearchResults: 'Nie znaleziono wyników wyszukiwania'
                },
                products: {
                    manageProducts: 'Zarządzaj produktami',
                    addNewProduct: 'Dodaj nowy produkt',
                    addProductTitle: 'Dodaj nowy produkt',
                    editProductTitle: 'Edytuj produkt',
                    productName: 'Nazwa produktu:',
                    productPrice: 'Cena:',
                    productDescription: 'Opis:',
                    saveProduct: 'Zapisz produkt',
                    cancel: 'Anuluj',
                    searchPlaceholder: 'Szukaj produktów...',
                    tableHeaders: ['Nazwa produktu', 'Cena', 'Opis', 'Data dodania', 'Działania'],
                    edit: 'Edytuj',
                    delete: 'Usuń',
                    noProducts: 'Brak produktów',
                    addProductsPrompt: 'Zacznij od dodania nowych produktów do sklepu',
                    selectAction: 'Wybierz działanie'
                },
                orders: {
                    manageOrders: 'Zarządzaj zamówieniami',
                    addNewOrderTable: 'Dodaj nowe zamówienia',
                    editOrderTitle: 'Edytuj zamówienie',
                    addRow: 'Dodaj wiersz',
                    saveAll: 'Zapisz wszystko',
                    clearAll: 'Wyczyść wszystko',
                    saveOrder: 'Zapisz zmiany',
                    cancel: 'Anuluj',
                    actions: 'Działania',
                    searchPlaceholder: 'Szukaj zamówień...',
                    dataManagement: 'Zarządzanie danymi',
                    exportExcel: 'Eksportuj Excel',
                    exportPDF: 'Eksportuj PDF',
                    exportJSON: 'Eksportuj JSON',
                    print: 'Drukuj',
                    import: 'Importuj dane',
                    whatsapp: 'WhatsApp',
                    copy: 'Kopiuj',
                    view: 'Zobacz',
                    edit: 'Edytuj',
                    delete: 'Usuń',
                    sendAllWhatsApp: 'Wyślij wszystko WhatsApp',
                    sendAllEmail: 'Wyślij wszystko emailem',
                    selectAction: 'Wybierz działanie',
                    orderId: 'ID zamówienia',
                    customerName: 'Nazwa klienta',
                    customerPhone: 'Numer telefonu',
                    customerEmail: 'E-mail',
                    customerAddress: 'Adres',
                    productName: 'Nazwa produktu',
                    orderDate: 'Data zamówienia',
                    totalAmount: 'Łączna kwota',
                    currency: 'Waluta',
                    orderStatus: 'Status zamówienia',
                    paymentStatus: 'Status płatności',
                    remainingAmount: 'Pozostała kwota',
                    shippingMethod: 'Metoda wysyłki',
                    shippingDate: 'Data wysyłki',
                    noOrders: 'Brak zamówień',
                    addOrdersPrompt: 'Zamówienia będą wyświetlane tutaj po dodaniu'
                },
                customers: {
                    manageCustomers: 'Zarządzaj klientami',
                    addNewCustomer: 'Dodaj nowego klienta',
                    addCustomerTitle: 'Dodaj nowego klienta',
                    customerName: 'Nazwa klienta:',
                    customerPhone: 'Numer telefonu:',
                    customerEmail: 'E-mail:',
                    customerAddress: 'Adres:',
                    saveCustomer: 'Zapisz klienta',
                    cancel: 'Anuluj',
                    searchPlaceholder: 'Szukaj klientów...',
                    tableHeaders: ['Nazwa klienta', 'Numer telefonu', 'E-mail', 'Adres', 'Data rejestracji', 'Działania'],
                    delete: 'Usuń',
                    selectAction: 'Wybierz działanie',
                    noEmail: 'Brak',
                    noCustomers: 'Brak klientów',
                    addCustomerPrompt: 'Zacznij dodawać nowych klientów'
                },
                reports: {
                    title: 'Raporty i statystyki',
                    fromDate: 'Od daty:',
                    toDate: 'Do daty:',
                    generateReport: 'Generuj raport',
                    reportTitle: 'Raport sprzedaży od',
                    to: 'do',
                    totalOrders: 'Łączna liczba zamówień',
                    completedOrders: 'Zakończone zamówienia',
                    totalRevenue: 'Łączny przychód',
                    avgOrderValue: 'Średnia wartość zamówienia',
                    bestSellingProducts: 'Najlepiej sprzedające się produkty',
                    productName: 'Produkt',
                    quantitySold: 'Liczba zamówień',
                    noSales: 'Brak sprzedaży w tym okresie',
                    topCustomers: 'Najlepsi klienci',
                    customerOrders: 'Liczba zamówień',
                    monthlySales: 'Sprzedaż miesięczna',
                    month: 'Miesiąc',
                    sales: 'Sprzedaż'
                },
                email: {
                    title: 'Zarządzanie emailem',
                    configuration: 'Konfiguracja emaila',
                    publicKey: 'Klucz publiczny EmailJS:',
                    templateId: 'ID szablonu:',
                    saveConfig: 'Zapisz konfigurację',
                    testConnection: 'Testuj połączenie',
                    actions: 'Akcje emaila',
                    sendOrders: 'Wyślij zamówienia',
                    sendCustomers: 'Wyślij klientów',
                    sendProducts: 'Wyślij produkty',
                    sendReport: 'Wyślij niestandardowy raport',
                    sendCustomEmail: 'Wyślij niestandardowy email',
                    toEmail: 'Do (Email):',
                    subject: 'Temat:',
                    message: 'Wiadomość:',
                    sendMessage: 'Wyślij wiadomość',
                    history: 'Historia emaili',
                    connectionSuccess: 'Połączenie udane',
                    connectionError: 'Błąd połączenia',
                    emailSent: 'Email wysłany pomyślnie',
                    emailError: 'Błąd wysyłania emaila'
                },
                alerts: {
                    fillRequiredFields: 'Proszę wypełnić wszystkie wymagane pola',
                    invalidCredentials: 'Nieprawidłowa nazwa użytkownika lub hasło',
                    logoutConfirm: 'Czy na pewno chcesz się wylogować?',
                    confirmDeleteOrder: 'Czy na pewno chcesz usunąć to zamówienie?',
                    confirmDeleteProduct: 'Czy na pewno chcesz usunąć ten produkt?',
                    confirmDeleteCustomer: 'Czy na pewno chcesz usunąć tego klienta?',
                    ordersSaved: 'Wszystkie zamówienia zostały zapisane pomyślnie',
                    orderUpdated: 'Zamówienie zostało zaktualizowane pomyślnie',
                    productSaved: 'Produkt został zapisany pomyślnie',
                    customerSaved: 'Klient został zapisany pomyślnie',
                    dataCopied: 'Dane zostały skopiowane do schowka',
                    selectDates: 'Proszę wybrać daty początkową i końcową',
                    accountCreated: 'Konto zostało utworzone pomyślnie, możesz się teraz zalogować',
                    passwordSentEmail: 'Hasło zostało wysłane na adres email',
                    emailNotFound: 'Email lub nazwa użytkownika nie została znaleziona',
                    usernameExists: 'Nazwa użytkownika już istnieje',
                    emailExists: 'Email już istnieje',
                    invalidEmail: 'Proszę podać prawidłowy adres email',
                    passwordMismatch: 'Hasła nie pasują do siebie',
                    weakPassword: 'Hasło musi mieć co najmniej 6 znaków',
                    emailConfigSaved: 'Konfiguracja emaila została zapisana pomyślnie',
                    emailConfigRequired: 'Proszę najpierw skonfigurować ustawienia EmailJS'
                }
            }
        };

        // متغيرات البيانات
        let allUsers = JSON.parse(localStorage.getItem('allUsers')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let currentLanguage = localStorage.getItem('currentLanguage') || 'ar';
        let currentEditId = null;
        let products = [];
        let orders = [];
        let customers = [];
        let newOrderRows = [];
        let emailHistory = JSON.parse(localStorage.getItem('emailHistory')) || [];
        let emailConfig = JSON.parse(localStorage.getItem('emailConfig')) || {
            publicKey: '',
            templateId: '',
            serviceId: 'service_6xzbr5j'
        };

        // رموز العملات
        const currencySymbols = {
            SAR: 'ر.س',
            USD: '$',
            EUR: '€',
            PLN: 'zł'
        };

        // إنشاء مستخدم افتراضي
        function createDefaultUser() {
            const defaultUser = {
                id: 'default_admin',
                username: 'admin',
                email: 'admin@store.com',
                password: '123456',
                fullName: 'مدير النظام',
                createdAt: new Date().toISOString(),
                lastLogin: null
            };
            
            const existingDefault = allUsers.find(u => u.username === 'admin');
            if (!existingDefault) {
                allUsers.push(defaultUser);
                localStorage.setItem('allUsers', JSON.stringify(allUsers));
            }
        }

        // إنشاء معرف فريد
        function generateId() {
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // التحقق من صحة البريد الإلكتروني
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // تكوين EmailJS
        function initEmailJS() {
            if (emailConfig.publicKey) {
                emailjs.init(emailConfig.publicKey);
            }
        }

        // حفظ إعدادات الإيميل
        function saveEmailConfig() {
            const publicKey = document.getElementById('emailjsPublicKey').value.trim();
            const templateId = document.getElementById('emailjsTemplateId').value.trim();
            
            if (!publicKey || !templateId) {
                alert(translations[currentLanguage].alerts.fillRequiredFields);
                return;
            }
            
            emailConfig.publicKey = publicKey;
            emailConfig.templateId = templateId;
            
            localStorage.setItem('emailConfig', JSON.stringify(emailConfig));
            initEmailJS();
            
            showNotification(translations[currentLanguage].alerts.emailConfigSaved);
        }

        // اختبار اتصال الإيميل
        function testEmailConnection() {
            const statusElement = document.getElementById('emailConnectionStatus');
            statusElement.style.display = 'inline-block';
            statusElement.textContent = translations[currentLanguage].email.connectionSuccess;
            statusElement.className = 'email-status success';
            
            // محاكاة اختبار الاتصال
            setTimeout(() => {
                if (emailConfig.publicKey && emailConfig.templateId) {
                    statusElement.textContent = translations[currentLanguage].email.connectionSuccess;
                    statusElement.className = 'email-status success';
                } else {
                    statusElement.textContent = translations[currentLanguage].email.connectionError;
                    statusElement.className = 'email-status error';
                }
                
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 3000);
            }, 1000);
        }

        // إرسال إيميل مخصص
        document.getElementById('customEmailForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!emailConfig.publicKey || !emailConfig.templateId) {
                alert(translations[currentLanguage].alerts.emailConfigRequired);
                return;
            }
            
            const templateParams = {
                to_email: document.getElementById('customEmailTo').value,
                subject: document.getElementById('customEmailSubject').value,
                message: document.getElementById('customEmailMessage').value,
                from_name: currentUser.fullName,
                from_email: currentUser.email
            };
            
            emailjs.send(emailConfig.serviceId, emailConfig.templateId, templateParams)
                .then(function(response) {
                    showNotification(translations[currentLanguage].email.emailSent);
                    
                    // حفظ في السجل
                    const emailRecord = {
                        id: Date.now(),
                        to: templateParams.to_email,
                        subject: templateParams.subject,
                        message: templateParams.message,
                        sentAt: new Date().toISOString(),
                        sentBy: currentUser.fullName,
                        status: 'sent'
                    };
                    
                    emailHistory.unshift(emailRecord);
                    localStorage.setItem('emailHistory', JSON.stringify(emailHistory));
                    updateEmailHistory();
                    
                    document.getElementById('customEmailForm').reset();
                })
                .catch(function(error) {
                    console.error('EmailJS Error:', error);
                    alert(translations[currentLanguage].email.emailError + ': ' + error.text);
                });
        });

        // إرسال جميع الطلبات بالإيميل
        function sendAllOrdersByEmail() {
            if (!emailConfig.publicKey || !emailConfig.templateId) {
                alert(translations[currentLanguage].alerts.emailConfigRequired);
                return;
            }
            
            if (orders.length === 0) {
                alert(translations[currentLanguage].orders.noOrders);
                return;
            }
            
            const emailTo = prompt(translations[currentLanguage].email.toEmail);
            if (!emailTo || !validateEmail(emailTo)) {
                alert(translations[currentLanguage].alerts.invalidEmail);
                return;
            }
            
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            const totalRevenue = orders.reduce((sum, order) => sum + order.totalAmount, 0);
            
            let emailContent = `
${translations[currentLanguage].orders.manageOrders} - ${currentUser.fullName}
${translations[currentLanguage].reports.reportTitle}: ${new Date().toLocaleDateString(locale)}

${translations[currentLanguage].dashboard.totalOrders}: ${orders.length}
${translations[currentLanguage].dashboard.totalRevenue}: ${totalRevenue.toFixed(2)}

${translations[currentLanguage].orders.orderId} | ${translations[currentLanguage].orders.customerName} | ${translations[currentLanguage].orders.productName} | ${translations[currentLanguage].orders.totalAmount}
${'='.repeat(80)}
`;
            
            orders.forEach((order, index) => {
                emailContent += `${index + 1}. ${order.id} | ${order.customerName} | ${order.productName} | ${order.totalAmount.toFixed(2)} ${currencySymbols[order.currency]}\n`;
            });
            
            const templateParams = {
                to_email: emailTo,
                subject: `${translations[currentLanguage].orders.manageOrders} - ${currentUser.fullName}`,
                message: emailContent,
                from_name: currentUser.fullName,
                from_email: currentUser.email
            };
            
            emailjs.send(emailConfig.serviceId, emailConfig.templateId, templateParams)
                .then(function(response) {
                    showNotification(translations[currentLanguage].email.emailSent);
                    
                    const emailRecord = {
                        id: Date.now(),
                        to: emailTo,
                        subject: templateParams.subject,
                        message: `${translations[currentLanguage].orders.manageOrders} (${orders.length} ${translations[currentLanguage].orders.orderId})`,
                        sentAt: new Date().toISOString(),
                        sentBy: currentUser.fullName,
                        status: 'sent'
                    };
                    
                    emailHistory.unshift(emailRecord);
                    localStorage.setItem('emailHistory', JSON.stringify(emailHistory));
                    updateEmailHistory();
                })
                .catch(function(error) {
                    console.error('EmailJS Error:', error);
                    alert(translations[currentLanguage].email.emailError + ': ' + error.text);
                });
        }

        // إرسال العملاء بالإيميل
        function sendCustomersByEmail() {
            if (!emailConfig.publicKey || !emailConfig.templateId) {
                alert(translations[currentLanguage].alerts.emailConfigRequired);
                return;
            }
            
            if (customers.length === 0) {
                alert(translations[currentLanguage].customers.noCustomers);
                return;
            }
            
            const emailTo = prompt(translations[currentLanguage].email.toEmail);
            if (!emailTo || !validateEmail(emailTo)) {
                alert(translations[currentLanguage].alerts.invalidEmail);
                return;
            }
            
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            
            let emailContent = `
${translations[currentLanguage].customers.manageCustomers} - ${currentUser.fullName}
${translations[currentLanguage].reports.reportTitle}: ${new Date().toLocaleDateString(locale)}

${translations[currentLanguage].dashboard.totalCustomers}: ${customers.length}

${translations[currentLanguage].customers.customerName} | ${translations[currentLanguage].customers.customerPhone} | ${translations[currentLanguage].customers.customerEmail}
${'='.repeat(80)}
`;
            
            customers.forEach((customer, index) => {
                emailContent += `${index + 1}. ${customer.name} | ${customer.phone} | ${customer.email || translations[currentLanguage].customers.noEmail}\n`;
            });
            
            const templateParams = {
                to_email: emailTo,
                subject: `${translations[currentLanguage].customers.manageCustomers} - ${currentUser.fullName}`,
                message: emailContent,
                from_name: currentUser.fullName,
                from_email: currentUser.email
            };
            
            emailjs.send(emailConfig.serviceId, emailConfig.templateId, templateParams)
                .then(function(response) {
                    showNotification(translations[currentLanguage].email.emailSent);
                    
                    const emailRecord = {
                        id: Date.now(),
                        to: emailTo,
                        subject: templateParams.subject,
                        message: `${translations[currentLanguage].customers.manageCustomers} (${customers.length} ${translations[currentLanguage].customers.customerName})`,
                        sentAt: new Date().toISOString(),
                        sentBy: currentUser.fullName,
                        status: 'sent'
                    };
                    
                    emailHistory.unshift(emailRecord);
                    localStorage.setItem('emailHistory', JSON.stringify(emailHistory));
                    updateEmailHistory();
                })
                .catch(function(error) {
                    console.error('EmailJS Error:', error);
                    alert(translations[currentLanguage].email.emailError + ': ' + error.text);
                });
        }

        // إرسال المنتجات بالإيميل
        function sendProductsByEmail() {
            if (!emailConfig.publicKey || !emailConfig.templateId) {
                alert(translations[currentLanguage].alerts.emailConfigRequired);
                return;
            }
            
            if (products.length === 0) {
                alert(translations[currentLanguage].products.noProducts);
                return;
            }
            
            const emailTo = prompt(translations[currentLanguage].email.toEmail);
            if (!emailTo || !validateEmail(emailTo)) {
                alert(translations[currentLanguage].alerts.invalidEmail);
                return;
            }
            
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            
            let emailContent = `
${translations[currentLanguage].products.manageProducts} - ${currentUser.fullName}
${translations[currentLanguage].reports.reportTitle}: ${new Date().toLocaleDateString(locale)}

${translations[currentLanguage].dashboard.totalProducts}: ${products.length}

${translations[currentLanguage].products.productName} | ${translations[currentLanguage].products.productPrice} | ${translations[currentLanguage].products.productDescription}
${'='.repeat(80)}
`;
            
            products.forEach((product, index) => {
                emailContent += `${index + 1}. ${product.name} | ${product.price.toFixed(2)} | ${product.description || translations[currentLanguage].products.noProducts}\n`;
            });
            
            const templateParams = {
                to_email: emailTo,
                subject: `${translations[currentLanguage].products.manageProducts} - ${currentUser.fullName}`,
                message: emailContent,
                from_name: currentUser.fullName,
                from_email: currentUser.email
            };
            
            emailjs.send(emailConfig.serviceId, emailConfig.templateId, templateParams)
                .then(function(response) {
                    showNotification(translations[currentLanguage].email.emailSent);
                    
                    const emailRecord = {
                        id: Date.now(),
                        to: emailTo,
                        subject: templateParams.subject,
                        message: `${translations[currentLanguage].products.manageProducts} (${products.length} ${translations[currentLanguage].products.productName})`,
                        sentAt: new Date().toISOString(),
                        sentBy: currentUser.fullName,
                        status: 'sent'
                    };
                    
                    emailHistory.unshift(emailRecord);
                    localStorage.setItem('emailHistory', JSON.stringify(emailHistory));
                    updateEmailHistory();
                })
                .catch(function(error) {
                    console.error('EmailJS Error:', error);
                    alert(translations[currentLanguage].email.emailError + ': ' + error.text);
                });
        }

        // تحديث سجل الإيميلات
        function updateEmailHistory() {
            const container = document.getElementById('emailHistory');
            const t = translations[currentLanguage];
            
            if (emailHistory.length === 0) {
                container.innerHTML = `<p>${t.email.history} - ${currentLanguage === 'ar' ? 'لا توجد إيميلات مرسلة' : currentLanguage === 'en' ? 'No emails sent' : 'Brak wysłanych emaili'}</p>`;
                return;
            }
            
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            const historyHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>${t.email.toEmail}</th>
                            <th>${t.email.subject}</th>
                            <th>${currentLanguage === 'ar' ? 'تاريخ الإرسال' : currentLanguage === 'en' ? 'Sent Date' : 'Data wysłania'}</th>
                            <th>${currentLanguage === 'ar' ? 'الحالة' : currentLanguage === 'en' ? 'Status' : 'Status'}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${emailHistory.slice(0, 10).map(email => `
                            <tr>
                                <td>${email.to}</td>
                                <td>${email.subject}</td>
                                <td>${new Date(email.sentAt).toLocaleDateString(locale)}</td>
                                <td><span class="email-status ${email.status}">${email.status === 'sent' ? (currentLanguage === 'ar' ? 'تم الإرسال' : currentLanguage === 'en' ? 'Sent' : 'Wysłano') : (currentLanguage === 'ar' ? 'فشل' : currentLanguage === 'en' ? 'Failed' : 'Niepowodzenie')}</span></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = historyHTML;
        }

        // ملء البيانات التجريبية
        function fillDemoCredentials() {
            document.getElementById('loginUsernameEmail').value = 'admin';
            document.getElementById('loginPassword').value = '123456';
        }

        // تحميل بيانات المستخدم
        function loadUserData() {
            if (currentUser) {
                const userKey = `user_${currentUser.id}`;
                const userData = JSON.parse(localStorage.getItem(userKey)) || {
                    products: [],
                    orders: [],
                    customers: []
                };
                
                products = userData.products || [];
                orders = userData.orders || [];
                customers = userData.customers || [];
            }
        }

        // حفظ بيانات المستخدم
        function saveUserData() {
            if (currentUser) {
                const userKey = `user_${currentUser.id}`;
                const userData = {
                    products: products,
                    orders: orders,
                    customers: customers,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem(userKey, JSON.stringify(userData));
            }
        }

        // إنشاء رقم طلب
        function generateOrderId() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000);
            return `ORD-${timestamp}-${random}`;
        }

        // تغيير اللغة من شاشة تسجيل الدخول
        function changeLanguageFromLogin(lang) {
            currentLanguage = lang;
            localStorage.setItem('currentLanguage', lang);
            
            if (document.getElementById('languageSelect')) {
                document.getElementById('languageSelect').value = lang;
            }
            
            changeLanguage(lang);
        }

        // تغيير اللغة من الواجهة الرئيسية
        function changeLanguageFromMain(lang) {
            currentLanguage = lang;
            localStorage.setItem('currentLanguage', lang);
            
            document.getElementById('loginLanguageSelect').value = lang;
            
            changeLanguage(lang);
        }

        // تغيير اللغة
        function changeLanguage(lang) {
            const translation = translations[lang];
            
            document.documentElement.dir = translation.dir;
            document.documentElement.lang = lang;
            
            document.title = translation.title;
            if (document.getElementById('pageTitle')) {
                document.getElementById('pageTitle').textContent = translation.title;
            }
            
            updateLoginTexts();
            
            const elementsToTranslate = document.querySelectorAll('[data-translate]');
            elementsToTranslate.forEach(element => {
                const key = element.getAttribute('data-translate');
                const value = getNestedValue(translation, key);
                if (value) {
                    if (element.tagName === 'INPUT' && element.type !== 'submit') {
                        element.placeholder = value;
                    } else {
                        element.textContent = value;
                    }
                }
            });
            
            if (document.getElementById('adminBadge')) {
                document.getElementById('adminBadge').textContent = lang === 'ar' ? 'أدمين' : 'Admin';
            }
            
            if (document.getElementById('logoutBtn')) {
                document.getElementById('logoutBtn').textContent = lang === 'ar' ? 'خروج' : lang === 'en' ? 'Logout' : 'Wyloguj';
            }
            
            if (currentUser && document.getElementById('mainApp').style.display !== 'none') {
                setTimeout(() => {
                    updateDashboard();
                    displayOrders();
                    displayProducts();
                    displayCustomers();
                    updateEmailHistory();
                    
                    // تحديث إعدادات الإيميل
                    if (document.getElementById('emailjsPublicKey')) {
                        document.getElementById('emailjsPublicKey').value = emailConfig.publicKey || '';
                        document.getElementById('emailjsTemplateId').value = emailConfig.templateId || '';
                    }
                }, 100);
            }
        }

        // تحديث نصوص شاشة تسجيل الدخول
        function updateLoginTexts() {
            const translation = translations[currentLanguage];
            
            // تحديث العناوين حسب النموذج المعروض
            if (document.getElementById('loginForm').style.display === 'block') {
                document.getElementById('loginTitle').textContent = translation.login.title;
            } else if (document.getElementById('registerForm').style.display === 'block') {
                document.getElementById('loginTitle').textContent = translation.login.registerTitle;
            } else if (document.getElementById('forgotForm').style.display === 'block') {
                document.getElementById('loginTitle').textContent = translation.login.forgotTitle;
            }
            
            // تحديث التسميات
            document.getElementById('usernameOrEmailLabel').textContent = translation.login.usernameOrEmail;
            document.getElementById('passwordLabel').textContent = translation.login.password;
            document.getElementById('loginButton').textContent = translation.login.loginButton;
            
            document.getElementById('registerUsernameLabel').textContent = translation.login.username;
            document.getElementById('registerEmailLabel').textContent = translation.login.email;
            document.getElementById('registerPasswordLabel').textContent = translation.login.password;
            document.getElementById('registerPasswordConfirmLabel').textContent = translation.login.confirmPassword;
            document.getElementById('registerFullNameLabel').textContent = translation.login.fullName;
            document.getElementById('registerButton').textContent = translation.login.registerButton;
            
            document.getElementById('forgotUsernameEmailLabel').textContent = translation.login.usernameOrEmail;
            document.getElementById('forgotButton').textContent = translation.login.forgotButton;
            
            document.getElementById('showRegisterBtn').textContent = translation.login.createAccount;
            document.getElementById('showForgotBtn').textContent = translation.login.forgotPassword;
            document.getElementById('showLoginBtn').textContent = translation.login.backToLogin;
            
            document.getElementById('demoTitle').textContent = translation.login.demoTitle;
            document.getElementById('demoUser').textContent = translation.login.demoUser;
            document.getElementById('demoPass').textContent = translation.login.demoPass;
            document.getElementById('useDemoBtn').textContent = translation.login.useDemoBtn;
            document.getElementById('loginNote').textContent = translation.login.installNote;
        }

        // الحصول على قيمة من كائن متداخل
        function getNestedValue(obj, path) {
            return path.split('.').reduce((current, key) => current && current[key], obj);
        }

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            createDefaultUser();
            initEmailJS();
            
            if (currentUser) {
                loadUserData();
                showMainApp();
            } else {
                showLoginScreen();
            }
            
            if (document.getElementById('languageSelect')) {
                document.getElementById('languageSelect').value = currentLanguage;
            }
            document.getElementById('loginLanguageSelect').value = currentLanguage;
            changeLanguage(currentLanguage);
            
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
        });

        // أحداث النقر على الروابط
        document.getElementById('showRegisterBtn').addEventListener('click', showRegisterForm);
        document.getElementById('showForgotBtn').addEventListener('click', showForgotForm);
        document.getElementById('showLoginBtn').addEventListener('click', showLoginForm);

        // تسجيل الدخول
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            showLoginForm();
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            if (currentUser) {
                document.getElementById('currentUserDisplay').textContent = currentUser.fullName || currentUser.username;
            }
            
            updateDashboard();
            displayProducts();
            displayOrders();
            displayCustomers();
            updateEmailHistory();
            addNewOrderRow();
            
            // تحديث إعدادات الإيميل
            if (document.getElementById('emailjsPublicKey')) {
                document.getElementById('emailjsPublicKey').value = emailConfig.publicKey || '';
                document.getElementById('emailjsTemplateId').value = emailConfig.templateId || '';
            }
        }

        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('forgotForm').style.display = 'none';
            document.getElementById('demoCredentials').style.display = 'block';
            updateLoginTexts();
            document.getElementById('showLoginBtn').style.display = 'none';
            document.getElementById('showRegisterBtn').style.display = 'inline';
            document.getElementById('showForgotBtn').style.display = 'inline';
        }

        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('forgotForm').style.display = 'none';
            document.getElementById('demoCredentials').style.display = 'none';
            updateLoginTexts();
            document.getElementById('showLoginBtn').style.display = 'inline';
            document.getElementById('showRegisterBtn').style.display = 'none';
            document.getElementById('showForgotBtn').style.display = 'none';
        }

        function showForgotForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('forgotForm').style.display = 'block';
            document.getElementById('demoCredentials').style.display = 'none';
            updateLoginTexts();
            document.getElementById('showLoginBtn').style.display = 'inline';
            document.getElementById('showRegisterBtn').style.display = 'none';
            document.getElementById('showForgotBtn').style.display = 'none';
        }

        // نموذج تسجيل الدخول
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const usernameEmail = document.getElementById('loginUsernameEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;
            
            if (!usernameEmail || !password) {
                showMessage('loginError', translations[currentLanguage].alerts.fillRequiredFields);
                return;
            }
            
            const user = allUsers.find(u => 
                (u.username.toLowerCase() === usernameEmail || u.email.toLowerCase() === usernameEmail) &&
                u.password === password
            );
            
            if (user) {
                user.lastLogin = new Date().toISOString();
                localStorage.setItem('allUsers', JSON.stringify(allUsers));
                
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                loadUserData();
                showMainApp();
                hideMessage('loginError');
            } else {
                showMessage('loginError', translations[currentLanguage].alerts.invalidCredentials);
            }
        });

        // نموذج إنشاء الحساب
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('registerUsername').value.trim();
            const email = document.getElementById('registerEmail').value.trim().toLowerCase();
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            const fullName = document.getElementById('registerFullName').value.trim();
            
            // التحقق من صحة البيانات
            if (!username || !email || !password || !passwordConfirm || !fullName) {
                showMessage('loginError', translations[currentLanguage].alerts.fillRequiredFields);
                return;
            }
            
            if (!validateEmail(email)) {
                showMessage('loginError', translations[currentLanguage].alerts.invalidEmail);
                return;
            }
            
            if (password.length < 6) {
                showMessage('loginError', translations[currentLanguage].alerts.weakPassword);
                return;
            }
            
            if (password !== passwordConfirm) {
                showMessage('loginError', translations[currentLanguage].alerts.passwordMismatch);
                return;
            }
            
            // التحقق من عدم تكرار اسم المستخدم أو البريد الإلكتروني
            const existingUser = allUsers.find(u => 
                u.username.toLowerCase() === username.toLowerCase() || 
                u.email.toLowerCase() === email
            );
            
            if (existingUser) {
                if (existingUser.username.toLowerCase() === username.toLowerCase()) {
                    showMessage('loginError', translations[currentLanguage].alerts.usernameExists);
                } else {
                    showMessage('loginError', translations[currentLanguage].alerts.emailExists);
                }
                return;
            }
            
            // إنشاء مستخدم جديد
            const newUser = {
                id: generateId(),
                username: username,
                email: email,
                password: password,
                fullName: fullName,
                createdAt: new Date().toISOString(),
                lastLogin: null
            };
            
            allUsers.push(newUser);
            localStorage.setItem('allUsers', JSON.stringify(allUsers));
            
            showMessage('loginSuccess', translations[currentLanguage].alerts.accountCreated);
            document.getElementById('registerForm').reset();
            
            // التبديل إلى نموذج تسجيل الدخول بعد 2 ثانية
            setTimeout(() => {
                showLoginForm();
                hideMessage('loginSuccess');
            }, 2000);
        });

        // نموذج استرجاع كلمة المرور
        document.getElementById('forgotForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const usernameEmail = document.getElementById('forgotUsernameEmail').value.trim().toLowerCase();
            
            // البحث عن المستخدم
            const user = allUsers.find(u => 
                u.username.toLowerCase() === usernameEmail || u.email.toLowerCase() === usernameEmail
            );
            
            if (!user) {
                showMessage('loginError', translations[currentLanguage].alerts.emailNotFound);
                return;
            }
            
            // محاكاة إرسال البريد الإلكتروني
            const message = `${currentLanguage === 'ar' ? 'تم إرسال كلمة المرور إلى البريد الإلكتروني:' : currentLanguage === 'en' ? 'Password sent to email:' : 'Hasło zostało wysłane na adres email:'} ${user.email}\n\n${currentLanguage === 'ar' ? 'كلمة المرور الخاصة بك:' : currentLanguage === 'en' ? 'Your password:' : 'Twoje hasło:'} ${user.password}\n\n${currentLanguage === 'ar' ? '(هذه محاكاة - في النظام الحقيقي سيتم إرسال رابط إعادة تعيين كلمة المرور)' : currentLanguage === 'en' ? '(This is a simulation - in a real system, a password reset link would be sent)' : '(To jest symulacja - w prawdziwym systemie zostałby wysłany link do resetowania hasła)'}`;
            
            showMessage('loginSuccess', translations[currentLanguage].alerts.passwordSentEmail);
            alert(message);
            document.getElementById('forgotForm').reset();
        });

        function showMessage(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.style.display = 'block';
                
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000);
            }
        }

        function hideMessage(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.display = 'none';
            }
        }

        function logout() {
            if (confirm(translations[currentLanguage].alerts.logoutConfirm)) {
                saveUserData();
                currentUser = null;
                localStorage.removeItem('currentUser');
                showLoginScreen();
                
                // مسح النماذج
                document.querySelectorAll('form').forEach(form => form.reset());
                document.querySelectorAll('.message').forEach(msg => msg.style.display = 'none');
            }
        }

        function updateCurrentTime() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit' 
            };
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            if (document.getElementById('currentTime')) {
                document.getElementById('currentTime').textContent = now.toLocaleString(locale, options);
            }
        }

        // التنقل بين التبويبات
        function showTab(tabName) {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'products') {
                displayProducts();
            } else if (tabName === 'orders') {
                displayOrders();
            } else if (tabName === 'customers') {
                displayCustomers();
            } else if (tabName === 'email') {
                updateEmailHistory();
            }
        }

        // تحديث لوحة التحكم
        function updateDashboard() {
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('totalOrders').textContent = orders.length;
            document.getElementById('totalCustomers').textContent = customers.length;
            
            const totalRevenue = orders.reduce((sum, order) => sum + order.totalAmount, 0);
            document.getElementById('totalRevenue').textContent = totalRevenue.toFixed(2);

            updateRecentOrders();
            updateRecentProducts();
        }

        function updateRecentOrders() {
            const container = document.getElementById('recentOrders');
            const recentOrders = orders.slice(-5).reverse();
            const t = translations[currentLanguage];
            
            if (recentOrders.length === 0) {
                container.innerHTML = `<p>${t.dashboard.noRecentOrders}</p>`;
                return;
            }
            
            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>${t.orders.orderId}</th>
                            <th>${t.orders.customerName}</th>
                            <th>${t.orders.totalAmount}</th>
                            <th>${t.orders.currency}</th>
                            <th>${t.orders.orderStatus}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${recentOrders.map(order => {
                            const currency = order.currency || 'SAR';
                            return `
                                <tr>
                                    <td>${order.id}</td>
                                    <td>${order.customerName}</td>
                                    <td>${order.totalAmount.toFixed(2)} ${currencySymbols[currency]}</td>
                                    <td>${currency}</td>
                                    <td>${order.orderStatus}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }

        function updateRecentProducts() {
            const container = document.getElementById('recentProducts');
            const recentProducts = products.slice(-5).reverse();
            const t = translations[currentLanguage];
            
            if (recentProducts.length === 0) {
                container.innerHTML = `<p>${t.dashboard.noRecentProducts}</p>`;
                return;
            }
            
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>${t.products.tableHeaders[0]}</th>
                            <th>${t.products.tableHeaders[1]}</th>
                            <th>${t.products.tableHeaders[3]}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${recentProducts.map(product => `
                            <tr>
                                <td>${product.name}</td>
                                <td>${product.price.toFixed(2)}</td>
                                <td>${new Date(product.dateAdded).toLocaleDateString(locale)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }

        // البحث السريع في الطلبات
        function quickSearchOrders() {
            const orderIdTerm = document.getElementById('quickSearchOrderId').value.toLowerCase();
            const customerTerm = document.getElementById('quickSearchCustomer').value.toLowerCase();
            const resultsContainer = document.getElementById('quickSearchResults');
            
            if (!orderIdTerm && !customerTerm) {
                resultsContainer.innerHTML = '';
                return;
            }
            
            const filteredOrders = orders.filter(order => 
                (orderIdTerm && order.id.toLowerCase().includes(orderIdTerm)) ||
                (customerTerm && order.customerName.toLowerCase().includes(customerTerm))
            );
            
            if (filteredOrders.length === 0) {
                resultsContainer.innerHTML = `<p>${translations[currentLanguage].dashboard.noSearchResults}</p>`;
                return;
            }
            
            const resultsHTML = filteredOrders.map(order => `
                <div class="search-result-item" onclick="showOrderDetailsInSearch('${order.id}')">
                    <div class="search-result-header">
                        ${translations[currentLanguage].orders.orderId} ${order.id} - ${order.customerName}
                    </div>
                    <div style="font-size: 0.9rem; color: #666;">
                        ${translations[currentLanguage].orders.productName}: ${order.productName} | ${translations[currentLanguage].orders.totalAmount}: ${order.totalAmount.toFixed(2)} ${currencySymbols[order.currency || 'SAR']} | ${translations[currentLanguage].orders.orderStatus}: ${order.orderStatus}
                    </div>
                </div>
            `).join('');
            
            resultsContainer.innerHTML = resultsHTML;
        }

        function showOrderDetailsInSearch(orderId) {
            showTab('orders');
            setTimeout(() => {
                viewOrderDetails(orderId);
            }, 500);
        }

        // إدارة المنتجات
        function showAddProductForm() {
            currentEditId = null;
            document.getElementById('productModalTitle').textContent = translations[currentLanguage].products.addProductTitle;
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productDescription').value = '';
            showModal('productModal');
        }

        function showEditProductForm(id) {
            const product = products.find(p => p.id === id);
            if (product) {
                currentEditId = id;
                document.getElementById('productModalTitle').textContent = translations[currentLanguage].products.editProductTitle;
                document.getElementById('productName').value = product.name;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productDescription').value = product.description;
                showModal('productModal');
            }
        }

        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            currentEditId = null;
        }

        // معالج قائمة الإجراءات للمنتجات
        function handleProductAction(productId, action) {
            switch(action) {
                case 'edit':
                    showEditProductForm(productId);
                    break;
                case 'delete':
                    deleteProduct(productId);
                    break;
                default:
                    break;
            }
            // إعادة تعيين القائمة
            event.target.value = '';
        }

        // معالج قائمة الإجراءات للطلبات
        function handleOrderAction(orderId, action) {
            switch(action) {
                case 'view':
                    viewOrderDetails(orderId);
                    break;
                case 'edit':
                    showEditOrderForm(orderId);
                    break;
                case 'whatsapp':
                    sendToWhatsApp(orderId);
                    break;
                case 'excel':
                    exportOrderToExcel(orderId);
                    break;
                case 'pdf':
                    exportOrderToPDF(orderId);
                    break;
                case 'delete':
                    deleteOrder(orderId);
                    break;
                default:
                    break;
            }
            // إعادة تعيين القائمة
            event.target.value = '';
        }

        // معالج قائمة الإجراءات للعملاء
        function handleCustomerAction(customerId, action) {
            switch(action) {
                case 'delete':
                    deleteCustomer(customerId);
                    break;
                default:
                    break;
            }
            // إعادة تعيين القائمة
            event.target.value = '';
        }

        // نموذج المنتج
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const productData = {
                name: document.getElementById('productName').value.trim(),
                price: parseFloat(document.getElementById('productPrice').value),
                description: document.getElementById('productDescription').value.trim(),
                dateAdded: new Date().toISOString(),
                createdBy: currentUser.username
            };

            if (!productData.name || !productData.price || productData.price <= 0) {
                alert(translations[currentLanguage].alerts.fillRequiredFields);
                return;
            }

            if (currentEditId) {
                const index = products.findIndex(p => p.id === currentEditId);
                if (index !== -1) {
                    products[index] = { ...products[index], ...productData, updatedBy: currentUser.username };
                }
            } else {
                productData.id = Date.now().toString();
                products.push(productData);
            }

            saveUserData();
            displayProducts();
            updateDashboard();
            closeModal('productModal');
            showNotification(translations[currentLanguage].alerts.productSaved);
        });

        function deleteProduct(id) {
            if (confirm(translations[currentLanguage].alerts.confirmDeleteProduct)) {
                products = products.filter(p => p.id !== id);
                saveUserData();
                displayProducts();
                updateDashboard();
            }
        }

        function displayProducts() {
            const container = document.getElementById('productsContainer');
            const t = translations[currentLanguage];
            
            if (products.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #666;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">📦</div>
                        <h3>${t.products.noProducts}</h3>
                        <p>${t.products.addProductsPrompt}</p>
                    </div>
                `;
                return;
            }

            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            const table = `
                <table>
                    <thead>
                        <tr>
                            ${t.products.tableHeaders.map(header => `<th>${header}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${products.map(product => `
                            <tr>
                                <td>${product.name}</td>
                                <td>${product.price.toFixed(2)}</td>
                                <td>${product.description || (currentLanguage === 'ar' ? 'لا يوجد وصف' : currentLanguage === 'en' ? 'No description' : 'Brak opisu')}</td>
                                <td>${new Date(product.dateAdded).toLocaleDateString(locale)}</td>
                                <td>
                                    <select class="action-select" onchange="handleProductAction('${product.id}', this.value)">
                                        <option value="">${t.products.selectAction}</option>
                                        <option value="edit">${t.products.edit}</option>
                                        <option value="delete">${t.products.delete}</option>
                                    </select>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }

        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm) ||
                (product.description && product.description.toLowerCase().includes(searchTerm))
            );
            
            displayFilteredProducts(filteredProducts);
        }

        function displayFilteredProducts(productList) {
            const container = document.getElementById('productsContainer');
            const t = translations[currentLanguage];
            
            if (productList.length === 0) {
                container.innerHTML = `<p>${t.products.noProducts}</p>`;
                return;
            }

            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            const table = `
                <table>
                    <thead>
                        <tr>
                            ${t.products.tableHeaders.map(header => `<th>${header}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${productList.map(product => `
                            <tr>
                                <td>${product.name}</td>
                                <td>${product.price.toFixed(2)}</td>
                                <td>${product.description || (currentLanguage === 'ar' ? 'لا يوجد وصف' : currentLanguage === 'en' ? 'No description' : 'Brak opisu')}</td>
                                <td>${new Date(product.dateAdded).toLocaleDateString(locale)}</td>
                                <td>
                                    <select class="action-select" onchange="handleProductAction('${product.id}', this.value)">
                                        <option value="">${t.products.selectAction}</option>
                                        <option value="edit">${t.products.edit}</option>
                                        <option value="delete">${t.products.delete}</option>
                                    </select>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }

        // إدارة العملاء
        function showAddCustomerForm() {
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('customerAddress').value = '';
            showModal('customerModal');
        }

        // نموذج العميل
        document.getElementById('customerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customerData = {
                id: Date.now().toString(),
                name: document.getElementById('customerName').value.trim(),
                phone: document.getElementById('customerPhone').value.trim(),
                email: document.getElementById('customerEmail').value.trim(),
                address: document.getElementById('customerAddress').value.trim(),
                dateAdded: new Date().toISOString(),
                createdBy: currentUser.username
            };

            if (!customerData.name || !customerData.phone) {
                alert(translations[currentLanguage].alerts.fillRequiredFields);
                return;
            }
            
            customers.push(customerData);
            saveUserData();
            displayCustomers();
            updateDashboard();
            closeModal('customerModal');
            showNotification(translations[currentLanguage].alerts.customerSaved);
        });

        function deleteCustomer(id) {
            if (confirm(translations[currentLanguage].alerts.confirmDeleteCustomer)) {
                customers = customers.filter(c => c.id !== id);
                saveUserData();
                displayCustomers();
                updateDashboard();
            }
        }

        function displayCustomers() {
            const container = document.getElementById('customersContainer');
            const t = translations[currentLanguage];
            
            if (customers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #666;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">👥</div>
                        <h3>${t.customers.noCustomers}</h3>
                        <p>${t.customers.addCustomerPrompt}</p>
                    </div>
                `;
                return;
            }

            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            const table = `
                <table>
                    <thead>
                        <tr>
                            ${t.customers.tableHeaders.map(header => `<th>${header}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${customers.map(customer => `
                            <tr>
                                <td>${customer.name}</td>
                                <td>${customer.phone}</td>
                                <td>${customer.email || t.customers.noEmail}</td>
                                <td>${customer.address || t.customers.noEmail}</td>
                                <td>${new Date(customer.dateAdded).toLocaleDateString(locale)}</td>
                                <td>
                                    <select class="action-select" onchange="handleCustomerAction('${customer.id}', this.value)">
                                        <option value="">${t.customers.selectAction}</option>
                                        <option value="delete">${t.customers.delete}</option>
                                    </select>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }

        function searchCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm) ||
                customer.phone.includes(searchTerm) ||
                (customer.email && customer.email.toLowerCase().includes(searchTerm))
            );
            
            displayFilteredCustomers(filteredCustomers);
        }

        function displayFilteredCustomers(customerList) {
            const container = document.getElementById('customersContainer');
            const t = translations[currentLanguage];
            
            if (customerList.length === 0) {
                container.innerHTML = `<p>${t.customers.noCustomers}</p>`;
                return;
            }

            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            const table = `
                <table>
                    <thead>
                        <tr>
                            ${t.customers.tableHeaders.map(header => `<th>${header}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${customerList.map(customer => `
                            <tr>
                                <td>${customer.name}</td>
                                <td>${customer.phone}</td>
                                <td>${customer.email || t.customers.noEmail}</td>
                                <td>${customer.address || t.customers.noEmail}</td>
                                <td>${new Date(customer.dateAdded).toLocaleDateString(locale)}</td>
                                <td>
                                    <select class="action-select" onchange="handleCustomerAction('${customer.id}', this.value)">
                                        <option value="">${t.customers.selectAction}</option>
                                        <option value="delete">${t.customers.delete}</option>
                                    </select>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }

        // إدارة الطلبات - تعديل الطلب
        function showEditOrderForm(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                currentEditId = orderId;
                
                document.getElementById('editOrderId').value = order.id;
                document.getElementById('editCustomerName').value = order.customerName;
                document.getElementById('editCustomerPhone').value = order.customerPhone;
                document.getElementById('editCustomerEmail').value = order.customerEmail || '';
                document.getElementById('editCustomerAddress').value = order.customerAddress;
                document.getElementById('editProductName').value = order.productName;
                document.getElementById('editOrderDate').value = order.orderDate;
                document.getElementById('editTotalAmount').value = order.totalAmount;
                document.getElementById('editCurrency').value = order.currency || 'SAR';
                document.getElementById('editPaymentStatus').value = order.paymentStatus;
                document.getElementById('editRemainingAmount').value = order.remainingAmount || 0;
                document.getElementById('editShippingMethod').value = order.shippingMethod;
                document.getElementById('editShippingDate').value = order.shippingDate || '';
                document.getElementById('editOrderStatus').value = order.orderStatus;
                
                showModal('editOrderModal');
            }
        }

        // نموذج تعديل الطلب
        document.getElementById('editOrderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentEditId) return;
            
            const orderData = {
                customerName: document.getElementById('editCustomerName').value.trim(),
                customerPhone: document.getElementById('editCustomerPhone').value.trim(),
                customerEmail: document.getElementById('editCustomerEmail').value.trim(),
                customerAddress: document.getElementById('editCustomerAddress').value.trim(),
                productName: document.getElementById('editProductName').value.trim(),
                orderDate: document.getElementById('editOrderDate').value,
                totalAmount: parseFloat(document.getElementById('editTotalAmount').value),
                currency: document.getElementById('editCurrency').value,
                paymentStatus: document.getElementById('editPaymentStatus').value.trim(),
                remainingAmount: parseFloat(document.getElementById('editRemainingAmount').value) || 0,
                shippingMethod: document.getElementById('editShippingMethod').value.trim(),
                shippingDate: document.getElementById('editShippingDate').value,
                orderStatus: document.getElementById('editOrderStatus').value.trim(),
                updatedBy: currentUser.username,
                lastUpdated: new Date().toISOString()
            };

            if (!orderData.customerName || !orderData.customerPhone || !orderData.productName || !orderData.totalAmount) {
                alert(translations[currentLanguage].alerts.fillRequiredFields);
                return;
            }

            const index = orders.findIndex(o => o.id === currentEditId);
            if (index !== -1) {
                orders[index] = { ...orders[index], ...orderData };
                saveUserData();
                displayOrders();
                updateDashboard();
                closeModal('editOrderModal');
                showNotification(translations[currentLanguage].alerts.orderUpdated);
            }
        });

        // وظيفة التقارير الكاملة
        function generateReport() {
            const fromDate = document.getElementById('reportFromDate').value;
            const toDate = document.getElementById('reportToDate').value;
            const t = translations[currentLanguage];
            
            if (!fromDate || !toDate) {
                alert(t.alerts.selectDates);
                return;
            }
            
            const filteredOrders = orders.filter(order => {
                const orderDate = order.orderDate;
                return orderDate >= fromDate && orderDate <= toDate;
            });
            
            const completedOrders = filteredOrders.filter(order => 
                order.orderStatus === 'completed' || order.orderStatus === 'تم' || order.orderStatus === 'مكتمل' || 
                order.orderStatus === 'zakończone' || order.orderStatus.toLowerCase().includes('complet')
            );
            
            const totalRevenue = completedOrders.reduce((sum, order) => sum + order.totalAmount, 0);
            const totalOrders = filteredOrders.length;
            const completedOrdersCount = completedOrders.length;
            const avgOrderValue = completedOrdersCount > 0 ? (totalRevenue / completedOrdersCount) : 0;
            
            // إحصائيات المنتجات
            const productSales = {};
            completedOrders.forEach(order => {
                if (productSales[order.productName]) {
                    productSales[order.productName] += 1;
                } else {
                    productSales[order.productName] = 1;
                }
            });
            
            const sortedProducts = Object.entries(productSales)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
            
            // إحصائيات العملاء
            const customerStats = {};
            filteredOrders.forEach(order => {
                if (customerStats[order.customerName]) {
                    customerStats[order.customerName].count += 1;
                    customerStats[order.customerName].total += order.totalAmount;
                } else {
                    customerStats[order.customerName] = {
                        count: 1,
                        total: order.totalAmount,
                        phone: order.customerPhone
                    };
                }
            });
            
            const topCustomers = Object.entries(customerStats)
                .sort(([,a], [,b]) => b.count - a.count)
                .slice(0, 5);
            
            // المبيعات الشهرية
            const monthlySales = {};
            filteredOrders.forEach(order => {
                const month = new Date(order.orderDate).toLocaleString(currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US', { year: 'numeric', month: 'long' });
                if (monthlySales[month]) {
                    monthlySales[month] += order.totalAmount;
                } else {
                    monthlySales[month] = order.totalAmount;
                }
            });
            
            const sortedMonthlySales = Object.entries(monthlySales)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 6);

            const reportHTML = `
                <div class="report-card">
                    <div class="report-header">
                        <h3>${t.reports.reportTitle} ${fromDate} ${t.reports.to} ${toDate}</h3>
                        <p style="color: #666; margin-top: 0.5rem;">${currentLanguage === 'ar' ? 'تم إنشاء التقرير بواسطة:' : currentLanguage === 'en' ? 'Report generated by:' : 'Raport wygenerowany przez:'} ${currentUser.fullName} (${currentUser.username})</p>
                        <p style="color: #666; font-size: 0.9rem;">${currentLanguage === 'ar' ? 'تاريخ الإنشاء:' : currentLanguage === 'en' ? 'Generated on:' : 'Data wygenerowania:'} ${new Date().toLocaleString(currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US')}</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${totalOrders}</div>
                            <div class="stat-label">${t.reports.totalOrders}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${completedOrdersCount}</div>
                            <div class="stat-label">${t.reports.completedOrders}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${totalRevenue.toFixed(2)}</div>
                            <div class="stat-label">${t.reports.totalRevenue}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${avgOrderValue.toFixed(2)}</div>
                            <div class="stat-label">${t.reports.avgOrderValue}</div>
                        </div>
                    </div>
                    
                    ${sortedProducts.length > 0 ? `
                        <h4 style="color: #667eea; margin-top: 2rem; margin-bottom: 1rem;">${t.reports.bestSellingProducts}</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>${t.reports.productName}</th>
                                    <th>${t.reports.quantitySold}</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${sortedProducts.map(([productName, count]) => `
                                    <tr>
                                        <td>${productName}</td>
                                        <td>${count}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : `<p style="margin-top: 2rem; color: #666;">${t.reports.noSales}</p>`}

                    ${topCustomers.length > 0 ? `
                        <h4 style="color: #667eea; margin-top: 2rem; margin-bottom: 1rem;">${t.reports.topCustomers}</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>${t.customers.customerName}</th>
                                    <th>${t.customers.customerPhone}</th>
                                    <th>${t.reports.customerOrders}</th>
                                    <th>${t.reports.totalRevenue}</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${topCustomers.map(([customerName, stats]) => `
                                    <tr>
                                        <td>${customerName}</td>
                                        <td>${stats.phone}</td>
                                        <td>${stats.count}</td>
                                        <td>${stats.total.toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : ''}

                    ${sortedMonthlySales.length > 0 ? `
                        <h4 style="color: #667eea; margin-top: 2rem; margin-bottom: 1rem;">${t.reports.monthlySales}</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>${t.reports.month}</th>
                                    <th>${t.reports.sales}</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${sortedMonthlySales.map(([month, sales]) => `
                                    <tr>
                                        <td>${month}</td>
                                        <td>${sales.toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : ''}
                    
                    <div style="margin-top: 2rem; padding: 1rem; background: #e3f2fd; border-radius: 8px; border: 1px solid #2196f3;">
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center;">
                            <button class="btn btn-excel" onclick="exportReportToExcel('${fromDate}', '${toDate}')">${t.orders.exportExcel}</button>
                            <button class="btn btn-pdf" onclick="exportReportToPDF('${fromDate}', '${toDate}')">${t.orders.exportPDF}</button>
                            <button class="btn" onclick="printReport('${fromDate}', '${toDate}')">${t.orders.print}</button>
                            <button class="btn btn-whatsapp" onclick="sendReportToWhatsApp('${fromDate}', '${toDate}')">${t.orders.whatsapp}</button>
                            <button class="btn btn-email" onclick="sendReportByEmail('${fromDate}', '${toDate}')">${t.email.sendReport}</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('reportResults').innerHTML = reportHTML;
        }

        // إرسال تقرير مخصص بالإيميل
        function sendReportByEmail(fromDate = null, toDate = null) {
            if (!emailConfig.publicKey || !emailConfig.templateId) {
                alert(translations[currentLanguage].alerts.emailConfigRequired);
                return;
            }
            
            let reportData;
            if (fromDate && toDate) {
                const filteredOrders = orders.filter(order => {
                    const orderDate = order.orderDate;
                    return orderDate >= fromDate && orderDate <= toDate;
                });
                reportData = filteredOrders;
            } else {
                const dates = prompt(translations[currentLanguage].alerts.selectDates + '\n' + translations[currentLanguage].reports.fromDate + ' (YYYY-MM-DD) | ' + translations[currentLanguage].reports.toDate + ' (YYYY-MM-DD)');
                if (!dates) return;
                
                const [startDate, endDate] = dates.split('|').map(d => d.trim());
                if (!startDate || !endDate) {
                    alert(translations[currentLanguage].alerts.selectDates);
                    return;
                }
                
                reportData = orders.filter(order => {
                    const orderDate = order.orderDate;
                    return orderDate >= startDate && orderDate <= endDate;
                });
                fromDate = startDate;
                toDate = endDate;
            }
            
            if (reportData.length === 0) {
                alert(translations[currentLanguage].reports.noSales);
                return;
            }
            
            const emailTo = prompt(translations[currentLanguage].email.toEmail);
            if (!emailTo || !validateEmail(emailTo)) {
                alert(translations[currentLanguage].alerts.invalidEmail);
                return;
            }
            
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            const completedOrders = reportData.filter(order => 
                order.orderStatus === 'completed' || order.orderStatus === 'تم' || order.orderStatus === 'مكتمل'
            );
            const totalRevenue = completedOrders.reduce((sum, order) => sum + order.totalAmount, 0);
            
            let emailContent = `
${translations[currentLanguage].reports.reportTitle} ${fromDate} ${translations[currentLanguage].reports.to} ${toDate}
${translations[currentLanguage].reports.reportTitle}: ${new Date().toLocaleDateString(locale)}
${currentLanguage === 'ar' ? 'تم إنشاء التقرير بواسطة:' : currentLanguage === 'en' ? 'Report generated by:' : 'Raport wygenerowany przez:'} ${currentUser.fullName}

${translations[currentLanguage].reports.totalOrders}: ${reportData.length}
${translations[currentLanguage].reports.completedOrders}: ${completedOrders.length}
${translations[currentLanguage].reports.totalRevenue}: ${totalRevenue.toFixed(2)}

${'='.repeat(80)}
${translations[currentLanguage].orders.orderId} | ${translations[currentLanguage].orders.customerName} | ${translations[currentLanguage].orders.productName} | ${translations[currentLanguage].orders.totalAmount} | ${translations[currentLanguage].orders.orderStatus}
${'='.repeat(80)}
`;
            
            reportData.forEach((order, index) => {
                emailContent += `${index + 1}. ${order.id} | ${order.customerName} | ${order.productName} | ${order.totalAmount.toFixed(2)} ${currencySymbols[order.currency]} | ${order.orderStatus}\n`;
            });
            
            const templateParams = {
                to_email: emailTo,
                subject: `${translations[currentLanguage].reports.reportTitle} ${fromDate} ${translations[currentLanguage].reports.to} ${toDate} - ${currentUser.fullName}`,
                message: emailContent,
                from_name: currentUser.fullName,
                from_email: currentUser.email
            };
            
            emailjs.send(emailConfig.serviceId, emailConfig.templateId, templateParams)
                .then(function(response) {
                    showNotification(translations[currentLanguage].email.emailSent);
                    
                    const emailRecord = {
                        id: Date.now(),
                        to: emailTo,
                        subject: templateParams.subject,
                        message: `${translations[currentLanguage].reports.reportTitle} (${reportData.length} ${translations[currentLanguage].orders.orderId})`,
                        sentAt: new Date().toISOString(),
                        sentBy: currentUser.fullName,
                        status: 'sent'
                    };
                    
                    emailHistory.unshift(emailRecord);
                    localStorage.setItem('emailHistory', JSON.stringify(emailHistory));
                    updateEmailHistory();
                })
                .catch(function(error) {
                    console.error('EmailJS Error:', error);
                    alert(translations[currentLanguage].email.emailError + ': ' + error.text);
                });
        }

        // إضافة صف طلب جديد
        function addNewOrderRow() {
            const tbody = document.getElementById('newOrdersBody');
            if (!tbody) return;
            
            const today = new Date().toISOString().split('T')[0];
            const rowId = `newOrder_${Date.now()}`;
            const orderId = generateOrderId();
            
            const row = document.createElement('tr');
            row.className = 'new-order-row';
            row.id = rowId;
            row.innerHTML = `
                <td><input type="text" class="order-id-input" value="${orderId}" data-field="orderId" placeholder="${translations[currentLanguage].orders.orderId}"></td>
                <td><input type="text" class="new-order-input" placeholder="${translations[currentLanguage].orders.customerName}" data-field="customerName" required></td>
                <td><input type="tel" class="new-order-input" placeholder="${translations[currentLanguage].orders.customerPhone}" data-field="customerPhone" required></td>
                <td><input type="email" class="new-order-input" placeholder="${translations[currentLanguage].orders.customerEmail}" data-field="customerEmail"></td>
                <td><input type="text" class="new-order-input" placeholder="${translations[currentLanguage].orders.customerAddress}" data-field="customerAddress" required></td>
                <td><input type="text" class="new-order-input" placeholder="${translations[currentLanguage].orders.productName}" data-field="productName" required></td>
                <td><input type="date" class="new-order-input" data-field="orderDate" value="${today}" required></td>
                <td><input type="number" class="new-order-input" placeholder="0.00" data-field="totalAmount" step="0.01" min="0" required></td>
                <td>
                    <select class="new-order-input" data-field="currency" required>
                        <option value="SAR">${currentLanguage === 'ar' ? 'ريال سعودي (SAR)' : currentLanguage === 'en' ? 'Saudi Riyal (SAR)' : 'Rial saudyjski (SAR)'}</option>
                        <option value="USD">${currentLanguage === 'ar' ? 'دولار أمريكي (USD)' : currentLanguage === 'en' ? 'US Dollar (USD)' : 'Dolar amerykański (USD)'}</option>
                        <option value="EUR">${currentLanguage === 'ar' ? 'يورو (EUR)' : currentLanguage === 'en' ? 'Euro (EUR)' : 'Euro (EUR)'}</option>
                        <option value="PLN">${currentLanguage === 'ar' ? 'زلوتي بولندي (PLN)' : currentLanguage === 'en' ? 'Polish Zloty (PLN)' : 'Złoty polski (PLN)'}</option>
                    </select>
                </td>
                <td><input type="text" class="new-order-input" placeholder="${translations[currentLanguage].orders.paymentStatus}" data-field="paymentStatus" required></td>
                <td><input type="number" class="new-order-input" placeholder="0.00" data-field="remainingAmount" step="0.01" min="0"></td>
                <td><input type="text" class="new-order-input" placeholder="${translations[currentLanguage].orders.shippingMethod}" data-field="shippingMethod" required></td>
                <td><input type="date" class="new-order-input" data-field="shippingDate"></td>
                <td><input type="text" class="new-order-input" placeholder="${translations[currentLanguage].orders.orderStatus}" data-field="orderStatus" required></td>
                <td>
                    <select class="action-select" onchange="handleNewOrderAction('${rowId}', this.value)">
                        <option value="">${translations[currentLanguage].orders.selectAction}</option>
                        <option value="copy">${translations[currentLanguage].orders.copy}</option>
                        <option value="whatsapp">${translations[currentLanguage].orders.whatsapp}</option>
                        <option value="delete">${translations[currentLanguage].orders.delete}</option>
                    </select>
                </td>
            `;
            
            tbody.appendChild(row);
            newOrderRows.push(rowId);
        }

        // معالج الإجراءات للطلبات الجديدة
        function handleNewOrderAction(rowId, action) {
            switch(action) {
                case 'copy':
                    copyOrderRow(rowId);
                    break;
                case 'whatsapp':
                    sendNewOrderToWhatsApp(rowId);
                    break;
                case 'delete':
                    removeOrderRow(rowId);
                    break;
                default:
                    break;
            }
            // إعادة تعيين القائمة
            event.target.value = '';
        }

        function removeOrderRow(rowId) {
            const row = document.getElementById(rowId);
            if (row) {
                row.remove();
                newOrderRows = newOrderRows.filter(id => id !== rowId);
            }
        }

        function copyOrderRow(rowId) {
            const row = document.getElementById(rowId);
            if (row) {
                const inputs = row.querySelectorAll('.new-order-input, .order-id-input');
                const rowData = {};
                
                inputs.forEach(input => {
                    const field = input.getAttribute('data-field');
                    rowData[field] = input.value;
                });
                
                addNewOrderRow();
                const newRow = document.querySelector('#newOrdersBody tr:last-child');
                const newInputs = newRow.querySelectorAll('.new-order-input, .order-id-input');
                
                newInputs.forEach(input => {
                    const field = input.getAttribute('data-field');
                    if (rowData[field] && field !== 'orderDate') {
                        input.value = rowData[field];
                    }
                });
                
                showNotification(translations[currentLanguage].alerts.dataCopied);
            }
        }

        function sendNewOrderToWhatsApp(rowId) {
            const row = document.getElementById(rowId);
            if (row) {
                const inputs = row.querySelectorAll('.new-order-input, .order-id-input');
                const orderData = {};
                
                inputs.forEach(input => {
                    const field = input.getAttribute('data-field');
                    orderData[field] = input.value;
                });
                
                if (!orderData.customerName || !orderData.customerPhone || !orderData.productName) {
                    alert(translations[currentLanguage].alerts.fillRequiredFields);
                    return;
                }
                
                const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
                const currency = orderData.currency || 'SAR';
                
                const message = `
*تفاصيل الطلب الجديد*
*رقم الطلب:* ${orderData.orderId}

👤 *العميل:* ${orderData.customerName}
📞 *الهاتف:* ${orderData.customerPhone}
📧 *البريد:* ${orderData.customerEmail || 'غير متوفر'}
📍 *العنوان:* ${orderData.customerAddress}

🛍️ *المنتج:* ${orderData.productName}
📅 *تاريخ الطلب:* ${orderData.orderDate ? new Date(orderData.orderDate).toLocaleDateString(locale) : 'غير محدد'}

💰 *المبلغ الإجمالي:* ${orderData.totalAmount} ${currencySymbols[currency]}
💳 *حالة الدفع:* ${orderData.paymentStatus}
💵 *المبلغ المتبقي:* ${orderData.remainingAmount || '0'} ${currencySymbols[currency]}

🚚 *طريقة الإرسال:* ${orderData.shippingMethod}
📅 *تاريخ الإرسال:* ${orderData.shippingDate ? new Date(orderData.shippingDate).toLocaleDateString(locale) : 'لم يحدد بعد'}
📋 *حالة الطلب:* ${orderData.orderStatus}

شكراً لك لاختيارنا! 🙏
                `;

                const encodedMessage = encodeURIComponent(message);
                const phoneNumber = orderData.customerPhone.replace(/[^0-9]/g, '');
                const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
                
                window.open(whatsappUrl, '_blank');
            }
        }

        function saveAllNewOrders() {
            const rows = document.querySelectorAll('.new-order-row');
            let savedCount = 0;
            
            rows.forEach(row => {
                const inputs = row.querySelectorAll('.new-order-input, .order-id-input');
                const orderData = {
                    dateCreated: new Date().toISOString(),
                    createdBy: currentUser.username
                };
                
                let isValid = true;
                inputs.forEach(input => {
                    const field = input.getAttribute('data-field');
                    const value = input.value.trim();
                    
                    if (input.required && !value) {
                        isValid = false;
                        input.style.borderColor = '#ff6b6b';
                    } else {
                        input.style.borderColor = '#e1e5e9';
                        if (field === 'totalAmount' || field === 'remainingAmount') {
                            orderData[field] = parseFloat(value) || 0;
                        } else {
                            orderData[field] = value;
                        }
                    }
                });
                
                if (isValid && orderData.customerName && orderData.customerPhone && orderData.productName) {
                    orderData.id = orderData.orderId || generateOrderId();
                    
                    if (!orderData.currency) {
                        orderData.currency = 'SAR';
                    }
                    
                    orders.push(orderData);
                    savedCount++;
                    row.style.backgroundColor = '#d4edda';
                    
                    setTimeout(() => {
                        row.remove();
                    }, 2000);
                }
            });
            
            if (savedCount > 0) {
                saveUserData();
                displayOrders();
                updateDashboard();
                alert(`${translations[currentLanguage].alerts.ordersSaved} (${savedCount} ${currentLanguage === 'ar' ? 'طلب' : currentLanguage === 'en' ? 'orders' : 'zamówień'})`);
                
                newOrderRows = [];
                document.getElementById('newOrdersBody').innerHTML = '';
                addNewOrderRow();
            } else {
                alert(translations[currentLanguage].alerts.fillRequiredFields);
            }
        }

        function clearNewOrders() {
            if (confirm(currentLanguage === 'ar' ? 'هل أنت متأكد من مسح جميع الصفوف؟' : currentLanguage === 'en' ? 'Are you sure you want to clear all rows?' : 'Czy na pewno chcesz wyczyścić wszystkie wiersze?')) {
                document.getElementById('newOrdersBody').innerHTML = '';
                newOrderRows = [];
                addNewOrderRow();
            }
        }

        // عرض الطلبات مع قائمة الإجراءات المنسدلة
        function displayOrders() {
            const container = document.getElementById('ordersContainer');
            const t = translations[currentLanguage];
            
            if (orders.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #666;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">🛒</div>
                        <h3>${t.orders.noOrders}</h3>
                        <p>${t.orders.addOrdersPrompt}</p>
                    </div>
                `;
                return;
            }

            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>${t.orders.orderId}</th>
                            <th>${t.orders.customerName}</th>
                            <th>${t.orders.customerPhone}</th>
                            <th>${t.orders.productName}</th>
                            <th>${t.orders.totalAmount}</th>
                            <th>${t.orders.currency}</th>
                            <th>${t.orders.orderStatus}</th>
                            <th>${t.orders.actions}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${orders.map(order => `
                            <tr>
                                <td style="font-family: monospace; font-weight: bold;">${order.id}</td>
                                <td><input type="text" class="editable-cell" value="${order.customerName}" onblur="saveOrderChange('${order.id}', 'customerName', this.value)"></td>
                                <td><input type="text" class="editable-cell" value="${order.customerPhone}" onblur="saveOrderChange('${order.id}', 'customerPhone', this.value)"></td>
                                <td><input type="text" class="editable-cell" value="${order.productName}" onblur="saveOrderChange('${order.id}', 'productName', this.value)"></td>
                                <td><input type="number" class="editable-cell" value="${order.totalAmount.toFixed(2)}" step="0.01" onblur="saveOrderChange('${order.id}', 'totalAmount', this.value)"> ${currencySymbols[order.currency] || 'ر.س'}</td>
                                <td>${order.currency}</td>
                                <td><input type="text" class="editable-cell" value="${order.orderStatus}" onblur="saveOrderChange('${order.id}', 'orderStatus', this.value)"></td>
                                <td>
                                    <select class="action-select" onchange="handleOrderAction('${order.id}', this.value)">
                                        <option value="">${t.orders.selectAction}</option>
                                        <option value="view">${t.orders.view}</option>
                                        <option value="edit">${t.orders.edit}</option>
                                        <option value="whatsapp">${t.orders.whatsapp}</option>
                                        <option value="excel">Excel</option>
                                        <option value="pdf">PDF</option>
                                        <option value="delete">${t.orders.delete}</option>
                                    </select>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }

        // حفظ تغيير الطلب
        function saveOrderChange(orderId, field, value) {
            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex !== -1) {
                if (field === 'totalAmount' || field === 'remainingAmount') {
                    value = parseFloat(value) || 0;
                }
                
                orders[orderIndex][field] = value;
                orders[orderIndex].updatedBy = currentUser.username;
                orders[orderIndex].lastUpdated = new Date().toISOString();
                saveUserData();
                updateDashboard();
            }
        }

        function deleteOrder(id) {
            if (confirm(translations[currentLanguage].alerts.confirmDeleteOrder)) {
                orders = orders.filter(o => o.id !== id);
                saveUserData();
                displayOrders();
                updateDashboard();
            }
        }

        function viewOrderDetails(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
                const currency = order.currency || 'SAR';
                const t = translations[currentLanguage];
                
                const details = `
${t.orders.orderId}: ${order.id}
${t.orders.customerName}: ${order.customerName}
${t.orders.customerPhone}: ${order.customerPhone}
${t.orders.customerEmail}: ${order.customerEmail || (currentLanguage === 'ar' ? 'غير متوفر' : currentLanguage === 'en' ? 'Not available' : 'Niedostępne')}
${t.orders.customerAddress}: ${order.customerAddress}
${t.orders.productName}: ${order.productName}
${t.orders.orderDate}: ${new Date(order.orderDate).toLocaleDateString(locale)}
${t.orders.totalAmount}: ${order.totalAmount.toFixed(2)} ${currencySymbols[currency]}
${t.orders.currency}: ${currency}
${t.orders.paymentStatus}: ${order.paymentStatus}
${t.orders.remainingAmount}: ${order.remainingAmount.toFixed(2)} ${currencySymbols[currency]}
${t.orders.shippingMethod}: ${order.shippingMethod}
${t.orders.shippingDate}: ${order.shippingDate ? new Date(order.shippingDate).toLocaleDateString(locale) : (currentLanguage === 'ar' ? 'لم يحدد بعد' : currentLanguage === 'en' ? 'Not set yet' : 'Jeszcze nie ustawiono')}
${t.orders.orderStatus}: ${order.orderStatus}
                `;
                alert(details);
            }
        }

        function sendToWhatsApp(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
                const currency = order.currency || 'SAR';
                
                const message = `
*تفاصيل الطلب ${order.id}*

👤 *العميل:* ${order.customerName}
📞 *الهاتف:* ${order.customerPhone}
📧 *البريد:* ${order.customerEmail || 'غير متوفر'}
📍 *العنوان:* ${order.customerAddress}

🛍️ *المنتج:* ${order.productName}
📅 *تاريخ الطلب:* ${new Date(order.orderDate).toLocaleDateString(locale)}

💰 *المبلغ الإجمالي:* ${order.totalAmount.toFixed(2)} ${currencySymbols[currency]}
💳 *حالة الدفع:* ${order.paymentStatus}
💵 *المبلغ المتبقي:* ${order.remainingAmount.toFixed(2)} ${currencySymbols[currency]}

🚚 *طريقة الإرسال:* ${order.shippingMethod}
📅 *تاريخ الإرسال:* ${order.shippingDate ? new Date(order.shippingDate).toLocaleDateString(locale) : 'لم يحدد بعد'}
📋 *حالة الطلب:* ${order.orderStatus}

شكراً لك لاختيارنا! 🙏
                `;

                const encodedMessage = encodeURIComponent(message);
                const phoneNumber = order.customerPhone.replace(/[^0-9]/g, '');
                const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
                
                window.open(whatsappUrl, '_blank');
            }
        }

        // البحث في الطلبات
        function searchOrders() {
            const searchTerm = document.getElementById('orderSearch').value.toLowerCase();
            const filteredOrders = orders.filter(order => 
                order.id.toLowerCase().includes(searchTerm) ||
                order.customerName.toLowerCase().includes(searchTerm) ||
                order.customerPhone.includes(searchTerm) ||
                order.productName.toLowerCase().includes(searchTerm) ||
                order.orderStatus.toLowerCase().includes(searchTerm)
            );
            
            displayFilteredOrders(filteredOrders);
        }

        function displayFilteredOrders(orderList) {
            const container = document.getElementById('ordersContainer');
            const t = translations[currentLanguage];
            
            if (orderList.length === 0) {
                container.innerHTML = `<p>${t.orders.noOrders}</p>`;
                return;
            }

            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>${t.orders.orderId}</th>
                            <th>${t.orders.customerName}</th>
                            <th>${t.orders.customerPhone}</th>
                            <th>${t.orders.productName}</th>
                            <th>${t.orders.totalAmount}</th>
                            <th>${t.orders.currency}</th>
                            <th>${t.orders.orderStatus}</th>
                            <th>${t.orders.actions}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${orderList.map(order => `
                            <tr>
                                <td style="font-family: monospace; font-weight: bold;">${order.id}</td>
                                <td><input type="text" class="editable-cell" value="${order.customerName}" onblur="saveOrderChange('${order.id}', 'customerName', this.value)"></td>
                                <td><input type="text" class="editable-cell" value="${order.customerPhone}" onblur="saveOrderChange('${order.id}', 'customerPhone', this.value)"></td>
                                <td><input type="text" class="editable-cell" value="${order.productName}" onblur="saveOrderChange('${order.id}', 'productName', this.value)"></td>
                                <td><input type="number" class="editable-cell" value="${order.totalAmount.toFixed(2)}" step="0.01" onblur="saveOrderChange('${order.id}', 'totalAmount', this.value)"> ${currencySymbols[order.currency] || 'ر.س'}</td>
                                <td>${order.currency}</td>
                                <td><input type="text" class="editable-cell" value="${order.orderStatus}" onblur="saveOrderChange('${order.id}', 'orderStatus', this.value)"></td>
                                <td>
                                    <select class="action-select" onchange="handleOrderAction('${order.id}', this.value)">
                                        <option value="">${t.orders.selectAction}</option>
                                        <option value="view">${t.orders.view}</option>
                                        <option value="edit">${t.orders.edit}</option>
                                        <option value="whatsapp">${t.orders.whatsapp}</option>
                                        <option value="excel">Excel</option>
                                        <option value="pdf">PDF</option>
                                        <option value="delete">${t.orders.delete}</option>
                                    </select>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
        }

        // وظائف التصدير (مختصرة للمساحة)
        function exportOrderToExcel(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const t = translations[currentLanguage];
            const csvContent = `${t.orders.orderId},${t.orders.customerName},${t.orders.customerPhone},${t.orders.customerEmail},${t.orders.customerAddress},${t.orders.productName},${t.orders.orderDate},${t.orders.totalAmount},${t.orders.currency},${t.orders.paymentStatus},${t.orders.remainingAmount},${t.orders.shippingMethod},${t.orders.shippingDate},${t.orders.orderStatus}
"${order.id}","${order.customerName}","${order.customerPhone}","${order.customerEmail || ''}","${order.customerAddress}","${order.productName}","${order.orderDate}","${order.totalAmount.toFixed(2)}","${order.currency}","${order.paymentStatus}","${order.remainingAmount.toFixed(2)}","${order.shippingMethod}","${order.shippingDate || ''}","${order.orderStatus}"`;
            
            downloadFile(csvContent, `order_${order.id}.csv`, 'text/csv');
            showNotification(currentLanguage === 'ar' ? 'تم تصدير الطلب إلى Excel بنجاح' : currentLanguage === 'en' ? 'Order exported to Excel successfully' : 'Zamówienie zostało wyeksportowane do Excel pomyślnie');
        }

        function exportOrderToPDF(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            const currency = order.currency || 'SAR';
            const t = translations[currentLanguage];
            
            const pdfContent = `
${currentLanguage === 'ar' ? 'تفاصيل الطلب' : currentLanguage === 'en' ? 'Order Details' : 'Szczegóły zamówienia'} ${order.id}

${currentLanguage === 'ar' ? 'معلومات العميل:' : currentLanguage === 'en' ? 'Customer Information:' : 'Informacje o kliencie:'}
${t.orders.customerName}: ${order.customerName}
${t.orders.customerPhone}: ${order.customerPhone}
${t.orders.customerEmail}: ${order.customerEmail || (currentLanguage === 'ar' ? 'غير متوفر' : currentLanguage === 'en' ? 'Not available' : 'Niedostępne')}
${t.orders.customerAddress}: ${order.customerAddress}

${currentLanguage === 'ar' ? 'تفاصيل الطلب:' : currentLanguage === 'en' ? 'Order Details:' : 'Szczegóły zamówienia:'}
${t.orders.productName}: ${order.productName}
${t.orders.orderDate}: ${new Date(order.orderDate).toLocaleDateString(locale)}

${currentLanguage === 'ar' ? 'المبالغ:' : currentLanguage === 'en' ? 'Amounts:' : 'Kwoty:'}
${t.orders.totalAmount}: ${order.totalAmount.toFixed(2)} ${currencySymbols[currency]}
${t.orders.currency}: ${currency}
${t.orders.paymentStatus}: ${order.paymentStatus}
${t.orders.remainingAmount}: ${order.remainingAmount.toFixed(2)} ${currencySymbols[currency]}

${currentLanguage === 'ar' ? 'الشحن:' : currentLanguage === 'en' ? 'Shipping:' : 'Wysyłka:'}
${t.orders.shippingMethod}: ${order.shippingMethod}
${t.orders.shippingDate}: ${order.shippingDate ? new Date(order.shippingDate).toLocaleDateString(locale) : (currentLanguage === 'ar' ? 'لم يحدد بعد' : currentLanguage === 'en' ? 'Not set yet' : 'Jeszcze nie ustawiono')}
${t.orders.orderStatus}: ${order.orderStatus}

${currentLanguage === 'ar' ? 'تم إنشاء التقرير في:' : currentLanguage === 'en' ? 'Report generated on:' : 'Raport wygenerowany:'} ${new Date().toLocaleString(locale)}
            `;
            
            downloadFile(pdfContent, `order_${order.id}.txt`, 'text/plain');
            showNotification(currentLanguage === 'ar' ? 'تم تصدير الطلب إلى PDF بنجاح' : currentLanguage === 'en' ? 'Order exported to PDF successfully' : 'Zamówienie zostało wyeksportowane do PDF pomyślnie');
        }

        // باقي الوظائف المختصرة
        function exportAllToExcel() {
            if (orders.length === 0) {
                alert(currentLanguage === 'ar' ? 'لا توجد طلبات للتصدير' : currentLanguage === 'en' ? 'No orders to export' : 'Brak zamówień do eksportu');
                return;
            }
            
            const t = translations[currentLanguage];
            let csvContent = `${t.orders.orderId},${t.orders.customerName},${t.orders.customerPhone},${t.orders.customerEmail},${t.orders.customerAddress},${t.orders.productName},${t.orders.orderDate},${t.orders.totalAmount},${t.orders.currency},${t.orders.paymentStatus},${t.orders.remainingAmount},${t.orders.shippingMethod},${t.orders.shippingDate},${t.orders.orderStatus}\n`;
            
            orders.forEach(order => {
                const row = [
                    order.id, order.customerName, order.customerPhone, order.customerEmail || '', order.customerAddress,
                    order.productName, order.orderDate, order.totalAmount.toFixed(2), order.currency, order.paymentStatus,
                    order.remainingAmount.toFixed(2), order.shippingMethod, order.shippingDate || '', order.orderStatus
                ];
                csvContent += row.map(field => `"${field}"`).join(',') + '\n';
            });
            
            downloadFile(csvContent, `all_orders_${currentUser.username}.csv`, 'text/csv');
            showNotification(currentLanguage === 'ar' ? 'تم تصدير جميع الطلبات إلى Excel بنجاح' : currentLanguage === 'en' ? 'All orders exported to Excel successfully' : 'Wszystkie zamówienia zostały wyeksportowane do Excel pomyślnie');
        }

        function exportAllToPDF() {
            if (orders.length === 0) {
                alert(currentLanguage === 'ar' ? 'لا توجد طلبات للتصدير' : currentLanguage === 'en' ? 'No orders to export' : 'Brak zamówień do eksportu');
                return;
            }
            
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            const t = translations[currentLanguage];
            let pdfContent = `${currentLanguage === 'ar' ? 'قائمة جميع الطلبات' : currentLanguage === 'en' ? 'All Orders List' : 'Lista wszystkich zamówień'} - ${currentUser.fullName}\n${currentLanguage === 'ar' ? 'تاريخ التصدير:' : currentLanguage === 'en' ? 'Export Date:' : 'Data eksportu:'} ${new Date().toLocaleString(locale)}\n\n`;
            
            orders.forEach((order, index) => {
                const currency = order.currency || 'SAR';
                pdfContent += `
${currentLanguage === 'ar' ? 'الطلب' : currentLanguage === 'en' ? 'Order' : 'Zamówienie'} ${index + 1}:
${t.orders.orderId}: ${order.id}
${t.orders.customerName}: ${order.customerName}
${t.orders.customerPhone}: ${order.customerPhone}
${t.orders.productName}: ${order.productName}
${t.orders.totalAmount}: ${order.totalAmount.toFixed(2)} ${currencySymbols[currency]}
${t.orders.orderStatus}: ${order.orderStatus}
${t.orders.orderDate}: ${new Date(order.orderDate).toLocaleDateString(locale)}

-------------------------------------------
`;
            });
            
            downloadFile(pdfContent, `all_orders_${currentUser.username}.txt`, 'text/plain');
            showNotification(currentLanguage === 'ar' ? 'تم تصدير جميع الطلبات إلى PDF بنجاح' : currentLanguage === 'en' ? 'All orders exported to PDF successfully' : 'Wszystkie zamówienia zostały wyeksportowane do PDF pomyślnie');
        }

        function exportAllToJSON() {
            const data = {
                user: { ...currentUser, password: '***' },
                orders: orders, products: products, customers: customers,
                exportDate: new Date().toISOString(),
                totalOrders: orders.length,
                totalRevenue: orders.reduce((sum, order) => sum + order.totalAmount, 0)
            };
            
            const jsonContent = JSON.stringify(data, null, 2);
            downloadFile(jsonContent, `store_data_${currentUser.username}.json`, 'application/json');
            showNotification(currentLanguage === 'ar' ? 'تم تصدير البيانات إلى JSON بنجاح' : currentLanguage === 'en' ? 'Data exported to JSON successfully' : 'Dane zostały wyeksportowane do JSON pomyślnie');
        }

        function printAllOrders() {
            if (orders.length === 0) {
                alert(currentLanguage === 'ar' ? 'لا توجد طلبات للطباعة' : currentLanguage === 'en' ? 'No orders to print' : 'Brak zamówień do wydruku');
                return;
            }
            
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            const t = translations[currentLanguage];
            const printContent = `
                <div style="padding: 20px; font-family: Arial, sans-serif; direction: ${translations[currentLanguage].dir};">
                    <h1 style="text-align: center; color: #667eea;">${currentLanguage === 'ar' ? 'قائمة الطلبات' : currentLanguage === 'en' ? 'Orders List' : 'Lista zamówień'} - ${currentUser.fullName}</h1>
                    <p style="text-align: center; color: #666;">${currentLanguage === 'ar' ? 'تاريخ الطباعة:' : currentLanguage === 'en' ? 'Print Date:' : 'Data wydruku:'} ${new Date().toLocaleString(locale)}</p>
                    <hr style="margin: 20px 0;">
                    
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background-color: #667eea; color: white;">
                                <th style="padding: 10px; border: 1px solid #ddd;">${t.orders.orderId}</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">${t.orders.customerName}</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">${t.orders.customerPhone}</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">${t.orders.productName}</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">${t.orders.totalAmount}</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">${t.orders.orderStatus}</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${orders.map(order => {
                                const currency = order.currency || 'SAR';
                                return `
                                    <tr>
                                        <td style="padding: 8px; border: 1px solid #ddd;">${order.id}</td>
                                        <td style="padding: 8px; border: 1px solid #ddd;">${order.customerName}</td>
                                        <td style="padding: 8px; border: 1px solid #ddd;">${order.customerPhone}</td>
                                        <td style="padding: 8px; border: 1px solid #ddd;">${order.productName}</td>
                                        <td style="padding: 8px; border: 1px solid #ddd;">${order.totalAmount.toFixed(2)} ${currencySymbols[currency]}</td>
                                        <td style="padding: 8px; border: 1px solid #ddd;">${order.orderStatus}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html dir="${translations[currentLanguage].dir}">
                <head>
                    <title>${currentLanguage === 'ar' ? 'قائمة الطلبات' : currentLanguage === 'en' ? 'Orders List' : 'Lista zamówień'} - ${currentUser.fullName}</title>
                    <style>body { font-family: Arial, sans-serif; margin: 0; padding: 20px; } @media print { body { margin: 0; } }</style>
                </head>
                <body>${printContent}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function sendAllToWhatsApp() {
            if (orders.length === 0) {
                alert(currentLanguage === 'ar' ? 'لا توجد طلبات للإرسال' : currentLanguage === 'en' ? 'No orders to send' : 'Brak zamówień do wysłania');
                return;
            }
            
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            const totalRevenue = orders.reduce((sum, order) => sum + order.totalAmount, 0);
            
            const message = `
*📊 ${currentLanguage === 'ar' ? 'تقرير شامل للطلبات' : currentLanguage === 'en' ? 'Comprehensive Orders Report' : 'Kompleksowy raport zamówień'}*
*${currentLanguage === 'ar' ? 'المدير:' : currentLanguage === 'en' ? 'Manager:' : 'Menedżer:'}* ${currentUser.fullName}
*${currentLanguage === 'ar' ? 'تاريخ التقرير:' : currentLanguage === 'en' ? 'Report Date:' : 'Data raportu:'}* ${new Date().toLocaleDateString(locale)}

*📈 ${currentLanguage === 'ar' ? 'إحصائيات سريعة:' : currentLanguage === 'en' ? 'Quick Statistics:' : 'Szybkie statystyki:'}*
- ${currentLanguage === 'ar' ? 'إجمالي الطلبات:' : currentLanguage === 'en' ? 'Total Orders:' : 'Łączna liczba zamówień:'} ${orders.length}
- ${currentLanguage === 'ar' ? 'إجمالي الإيرادات:' : currentLanguage === 'en' ? 'Total Revenue:' : 'Łączny przychód:'} ${totalRevenue.toFixed(2)}

*📋 ${currentLanguage === 'ar' ? 'ملخص الطلبات:' : currentLanguage === 'en' ? 'Orders Summary:' : 'Podsumowanie zamówień:'}*
${orders.slice(0, 10).map((order, index) => `
${index + 1}. ${currentLanguage === 'ar' ? 'طلب' : currentLanguage === 'en' ? 'Order' : 'Zamówienie'} ${order.id}
   ${currentLanguage === 'ar' ? 'العميل:' : currentLanguage === 'en' ? 'Customer:' : 'Klient:'} ${order.customerName}
   ${currentLanguage === 'ar' ? 'المنتج:' : currentLanguage === 'en' ? 'Product:' : 'Produkt:'} ${order.productName}
   ${currentLanguage === 'ar' ? 'المبلغ:' : currentLanguage === 'en' ? 'Amount:' : 'Kwota:'} ${order.totalAmount.toFixed(2)} ${currencySymbols[order.currency]}
   ${currentLanguage === 'ar' ? 'الحالة:' : currentLanguage === 'en' ? 'Status:' : 'Status:'} ${order.orderStatus}
`).join('')}

${orders.length > 10 ? `\n... ${currentLanguage === 'ar' ? 'و' : currentLanguage === 'en' ? 'and' : 'i'} ${orders.length - 10} ${currentLanguage === 'ar' ? 'طلب آخر' : currentLanguage === 'en' ? 'more orders' : 'więcej zamówień'}` : ''}

${currentLanguage === 'ar' ? 'تم إنشاء هذا التقرير تلقائياً من نظام إدارة المتجر' : currentLanguage === 'en' ? 'This report was automatically generated from the Store Management System' : 'Ten raport został automatycznie wygenerowany z Systemu Zarządzania Sklepem'} 📱
            `;

            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
        }

        // تصدير التقرير إلى Excel
        function exportReportToExcel(fromDate, toDate) {
            const t = translations[currentLanguage];
            const filteredOrders = orders.filter(order => {
                const orderDate = order.orderDate;
                return orderDate >= fromDate && orderDate <= toDate;
            });
            
            if (filteredOrders.length === 0) {
                alert(t.reports.noSales);
                return;
            }
            
            let csvContent = `${t.reports.reportTitle} ${fromDate} ${t.reports.to} ${toDate}\n\n`;
            csvContent += `${t.orders.orderId},${t.orders.customerName},${t.orders.customerPhone},${t.orders.productName},${t.orders.totalAmount},${t.orders.currency},${t.orders.orderStatus},${t.orders.orderDate}\n`;
            
            filteredOrders.forEach(order => {
                const row = [order.id, order.customerName, order.customerPhone, order.productName, order.totalAmount.toFixed(2), order.currency, order.orderStatus, order.orderDate];
                csvContent += row.map(field => `"${field}"`).join(',') + '\n';
            });
            
            downloadFile(csvContent, `report_${fromDate}_to_${toDate}.csv`, 'text/csv');
            showNotification(currentLanguage === 'ar' ? 'تم تصدير التقرير إلى Excel بنجاح' : currentLanguage === 'en' ? 'Report exported to Excel successfully' : 'Raport został wyeksportowany do Excel pomyślnie');
        }

        function exportReportToPDF(fromDate, toDate) {
            const t = translations[currentLanguage];
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            
            const filteredOrders = orders.filter(order => {
                const orderDate = order.orderDate;
                return orderDate >= fromDate && orderDate <= toDate;
            });
            
            const completedOrders = filteredOrders.filter(order => 
                order.orderStatus === 'completed' || order.orderStatus === 'تم' || order.orderStatus === 'مكتمل'
            );
            
            const totalRevenue = completedOrders.reduce((sum, order) => sum + order.totalAmount, 0);
            
            let pdfContent = `${t.reports.reportTitle} ${fromDate} ${t.reports.to} ${toDate}\n`;
            pdfContent += `${currentLanguage === 'ar' ? 'تم إنشاء التقرير بواسطة:' : currentLanguage === 'en' ? 'Report generated by:' : 'Raport wygenerowany przez:'} ${currentUser.fullName}\n`;
            pdfContent += `${currentLanguage === 'ar' ? 'تاريخ الإنشاء:' : currentLanguage === 'en' ? 'Generated on:' : 'Data wygenerowania:'} ${new Date().toLocaleString(locale)}\n\n`;
            
            pdfContent += `${currentLanguage === 'ar' ? 'ملخص الإحصائيات:' : currentLanguage === 'en' ? 'Statistics Summary:' : 'Podsumowanie statystyk:'}\n`;
            pdfContent += `${t.reports.totalOrders}: ${filteredOrders.length}\n${t.reports.completedOrders}: ${completedOrders.length}\n${t.reports.totalRevenue}: ${totalRevenue.toFixed(2)}\n\n`;
            
            if (filteredOrders.length > 0) {
                pdfContent += `${currentLanguage === 'ar' ? 'تفاصيل الطلبات:' : currentLanguage === 'en' ? 'Order Details:' : 'Szczegóły zamówień:'}\n`;
                filteredOrders.forEach((order, index) => {
                    pdfContent += `\n${index + 1}. ${t.orders.orderId}: ${order.id}\n   ${t.orders.customerName}: ${order.customerName}\n   ${t.orders.productName}: ${order.productName}\n   ${t.orders.totalAmount}: ${order.totalAmount.toFixed(2)} ${currencySymbols[order.currency]}\n   ${t.orders.orderStatus}: ${order.orderStatus}\n`;
                });
            }
            
            downloadFile(pdfContent, `report_${fromDate}_to_${toDate}.txt`, 'text/plain');
            showNotification(currentLanguage === 'ar' ? 'تم تصدير التقرير إلى PDF بنجاح' : currentLanguage === 'en' ? 'Report exported to PDF successfully' : 'Raport został wyeksportowany do PDF pomyślnie');
        }

        function printReport(fromDate, toDate) {
            const t = translations[currentLanguage];
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            
            const filteredOrders = orders.filter(order => {
                const orderDate = order.orderDate;
                return orderDate >= fromDate && orderDate <= toDate;
            });
            
            if (filteredOrders.length === 0) {
                alert(t.reports.noSales);
                return;
            }
            
            const printContent = `
                <div style="padding: 20px; font-family: Arial, sans-serif; direction: ${translations[currentLanguage].dir};">
                    <h1 style="text-align: center; color: #667eea;">${t.reports.reportTitle} ${fromDate} ${t.reports.to} ${toDate}</h1>
                    <p style="text-align: center; color: #666;">${currentUser.fullName} - ${new Date().toLocaleString(locale)}</p>
                    <hr style="margin: 20px 0;">
                    
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background-color: #667eea; color: white;">
                                <th style="padding: 10px; border: 1px solid #ddd;">${t.orders.orderId}</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">${t.orders.customerName}</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">${t.orders.productName}</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">${t.orders.totalAmount}</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">${t.orders.orderStatus}</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredOrders.map(order => {
                                const currency = order.currency || 'SAR';
                                return `<tr><td style="padding: 8px; border: 1px solid #ddd;">${order.id}</td><td style="padding: 8px; border: 1px solid #ddd;">${order.customerName}</td><td style="padding: 8px; border: 1px solid #ddd;">${order.productName}</td><td style="padding: 8px; border: 1px solid #ddd;">${order.totalAmount.toFixed(2)} ${currencySymbols[currency]}</td><td style="padding: 8px; border: 1px solid #ddd;">${order.orderStatus}</td></tr>`;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`<html dir="${translations[currentLanguage].dir}"><head><title>${t.reports.reportTitle} - ${currentUser.fullName}</title><style>body { font-family: Arial, sans-serif; margin: 0; padding: 20px; } @media print { body { margin: 0; } }</style></head><body>${printContent}</body></html>`);
            printWindow.document.close();
            printWindow.print();
        }

        function sendReportToWhatsApp(fromDate, toDate) {
            const t = translations[currentLanguage];
            const locale = currentLanguage === 'ar' ? 'ar-SA' : currentLanguage === 'pl' ? 'pl-PL' : 'en-US';
            
            const filteredOrders = orders.filter(order => {
                const orderDate = order.orderDate;
                return orderDate >= fromDate && orderDate <= toDate;
            });
            
            const completedOrders = filteredOrders.filter(order => 
                order.orderStatus === 'completed' || order.orderStatus === 'تم' || order.orderStatus === 'مكتمل'
            );
            
            const totalRevenue = completedOrders.reduce((sum, order) => sum + order.totalAmount, 0);
            
            const message = `
*📊 ${t.reports.reportTitle} ${fromDate} ${t.reports.to} ${toDate}*

*${currentLanguage === 'ar' ? 'المدير:' : currentLanguage === 'en' ? 'Manager:' : 'Menedżer:'}* ${currentUser.fullName}
*${currentLanguage === 'ar' ? 'تاريخ التقرير:' : currentLanguage === 'en' ? 'Report Date:' : 'Data raportu:'}* ${new Date().toLocaleDateString(locale)}

*📈 ${currentLanguage === 'ar' ? 'الإحصائيات:' : currentLanguage === 'en' ? 'Statistics:' : 'Statystyki:'}*
- ${t.reports.totalOrders}: ${filteredOrders.length}
- ${t.reports.completedOrders}: ${completedOrders.length}
- ${t.reports.totalRevenue}: ${totalRevenue.toFixed(2)}

*📋 ${currentLanguage === 'ar' ? 'أهم الطلبات:' : currentLanguage === 'en' ? 'Top Orders:' : 'Najważniejsze zamówienia:'}*
${filteredOrders.slice(0, 5).map((order, index) => `
${index + 1}. ${order.id} - ${order.customerName}
   ${t.orders.productName}: ${order.productName}
   ${t.orders.totalAmount}: ${order.totalAmount.toFixed(2)} ${currencySymbols[order.currency]}
`).join('')}

${currentLanguage === 'ar' ? 'تم إنشاء هذا التقرير تلقائياً من نظام إدارة المتجر' : currentLanguage === 'en' ? 'This report was automatically generated from the Store Management System' : 'Ten raport został automatycznie wygenerowany z Systemu Zarządzania Sklepem'} 📱
            `;

            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'copied-notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 2000);
        }

        function importData() {
            alert(currentLanguage === 'ar' ? 'ميزة استيراد البيانات ستكون متاحة قريباً' : currentLanguage === 'en' ? 'Data import feature will be available soon' : 'Funkcja importu danych będzie wkrótce dostępna');
        }

        // إغلاق النماذج عند النقر خارجها
        window.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // تشغيل التطبيق
        createDefaultUser();
        
        if (currentUser) {
            loadUserData();
            showMainApp();
        } else {
            showLoginScreen();
        }
        
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);
    </script>
</body>
</html>
